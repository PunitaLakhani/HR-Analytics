<html>

<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Title</title>
</head>

<body>

<p>This is an R HTML document. When you click the <b>Knit HTML</b> button a web page will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#Preliminary report </span>
<span class="hl com">#Abhishek Kumar.</span>

<span class="hl com">#few assumptions for Logistic Regression:</span>
<span class="hl com">#  no multicollinearity among the independent variables</span>
<span class="hl com">#  observations to be independent of each other</span>
<span class="hl com">#  dependent variable to be binary and ordinal </span>
<span class="hl com">#  logistic regression requires the dependent variable to be ordinal.</span>
<span class="hl com">#  linearity of independent variables and log odds</span>
<span class="hl com">#  requires a large sample size.  A general guideline is that you need </span>
<span class="hl com">#at minimum of 10 cases with the least frequent outcome for each </span>
<span class="hl com">#independent variable in your model. For example, if you have 5 </span>
<span class="hl com">#independent variables and the expected probability of your least </span>
<span class="hl com">#frequent outcome is .10, then you would need a minimum sample size of </span>
<span class="hl com">#500 (10*5 / .10).</span>

<span class="hl com">#setting the directory location</span>
<span class="hl kwd">setwd</span><span class="hl std">(</span><span class="hl str">&quot;G://analytics//ISB CBA//Residency//Residency3&amp;4//B9MT2SA2//Mini Project  Data sets-20180206//HR Analytics&quot;</span><span class="hl std">)</span>

<span class="hl com">#loading required library</span>
<span class="hl kwd">library</span><span class="hl std">(car)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'car' was built under R version 3.4.3
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(tidyverse)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'tidyverse' was built under R version 3.4.3
</pre></div>
<div class="message"><pre class="knitr r">## -- Attaching packages ---------------------------------- tidyverse 1.2.1 --
</pre></div>
<div class="message"><pre class="knitr r">## v ggplot2 2.2.1     v purrr   0.2.4
## v tibble  1.4.2     v dplyr   0.7.4
## v tidyr   0.8.0     v stringr 1.3.0
## v readr   1.1.1     v forcats 0.3.0
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'ggplot2' was built under R version 3.4.1
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'tibble' was built under R version 3.4.3
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'tidyr' was built under R version 3.4.3
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'readr' was built under R version 3.4.2
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'purrr' was built under R version 3.4.3
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'dplyr' was built under R version 3.4.3
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'stringr' was built under R version 3.4.3
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'forcats' was built under R version 3.4.3
</pre></div>
<div class="message"><pre class="knitr r">## -- Conflicts ------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## x dplyr::recode() masks car::recode()
## x purrr::some()   masks car::some()
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(ggplot2)</span>



<span class="hl com">#Reading the Hr file.</span>
<span class="hl std">hrdata</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;HR.csv&quot;</span><span class="hl std">,</span><span class="hl kwc">header</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">,</span><span class="hl kwc">stringsAsFactors</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">,</span><span class="hl kwc">na.strings</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;NA&quot;</span><span class="hl std">,</span><span class="hl str">&quot;N/A&quot;</span><span class="hl std">,</span><span class="hl str">&quot; &quot;</span><span class="hl std">))</span>
<span class="hl com">#View(hrdata)</span>
<span class="hl kwd">unique</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">sales)</span>
</pre></div>
<div class="output"><pre class="knitr r">##  [1] &quot;sales&quot;       &quot;accounting&quot;  &quot;hr&quot;          &quot;technical&quot;   &quot;support&quot;    
##  [6] &quot;management&quot;  &quot;IT&quot;          &quot;product_mng&quot; &quot;marketing&quot;   &quot;RandD&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">str</span><span class="hl std">(hrdata)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 'data.frame':	14999 obs. of  10 variables:
##  $ satisfaction_level   : num  0.38 0.8 0.11 0.72 0.37 0.41 0.1 0.92 0.89 0.42 ...
##  $ last_evaluation      : num  0.53 0.86 0.88 0.87 0.52 0.5 0.77 0.85 1 0.53 ...
##  $ number_project       : int  2 5 7 5 2 2 6 5 5 2 ...
##  $ average_montly_hours : int  157 262 272 223 159 153 247 259 224 142 ...
##  $ time_spend_company   : int  3 6 4 5 3 3 4 5 5 3 ...
##  $ Work_accident        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ left                 : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ promotion_last_5years: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ sales                : chr  &quot;sales&quot; &quot;sales&quot; &quot;sales&quot; &quot;sales&quot; ...
##  $ salary               : chr  &quot;low&quot; &quot;medium&quot; &quot;medium&quot; &quot;low&quot; ...
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">class</span><span class="hl std">(hrdata)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;data.frame&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">summary</span><span class="hl std">(hrdata)</span>
</pre></div>
<div class="output"><pre class="knitr r">##  satisfaction_level last_evaluation  number_project  average_montly_hours
##  Min.   :0.0900     Min.   :0.3600   Min.   :2.000   Min.   : 96.0       
##  1st Qu.:0.4400     1st Qu.:0.5600   1st Qu.:3.000   1st Qu.:156.0       
##  Median :0.6400     Median :0.7200   Median :4.000   Median :200.0       
##  Mean   :0.6128     Mean   :0.7161   Mean   :3.803   Mean   :201.1       
##  3rd Qu.:0.8200     3rd Qu.:0.8700   3rd Qu.:5.000   3rd Qu.:245.0       
##  Max.   :1.0000     Max.   :1.0000   Max.   :7.000   Max.   :310.0       
##  time_spend_company Work_accident         left       
##  Min.   : 2.000     Min.   :0.0000   Min.   :0.0000  
##  1st Qu.: 3.000     1st Qu.:0.0000   1st Qu.:0.0000  
##  Median : 3.000     Median :0.0000   Median :0.0000  
##  Mean   : 3.498     Mean   :0.1446   Mean   :0.2381  
##  3rd Qu.: 4.000     3rd Qu.:0.0000   3rd Qu.:0.0000  
##  Max.   :10.000     Max.   :1.0000   Max.   :1.0000  
##  promotion_last_5years    sales              salary         
##  Min.   :0.00000       Length:14999       Length:14999      
##  1st Qu.:0.00000       Class :character   Class :character  
##  Median :0.00000       Mode  :character   Mode  :character  
##  Mean   :0.02127                                            
##  3rd Qu.:0.00000                                            
##  Max.   :1.00000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#time_spend_company has value 10 hours which we will check if it is outlier or not.</span>
<span class="hl com">#WE can also check if we can build another model considering who will get the </span>
<span class="hl com">#promotion in five years now</span>
<span class="hl com">#we will do further investigation on sales and salary by converting </span>
<span class="hl com"># them into dummy variables</span>

<span class="hl com">#checking for missing value if any present in the data</span>
<span class="hl kwd">colSums</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(hrdata))</span>
</pre></div>
<div class="output"><pre class="knitr r">##    satisfaction_level       last_evaluation        number_project 
##                     0                     0                     0 
##  average_montly_hours    time_spend_company         Work_accident 
##                     0                     0                     0 
##                  left promotion_last_5years                 sales 
##                     0                     0                     0 
##                salary 
##                     0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(hrdata))</span> <span class="hl com"># no missing value in the data</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">nrow</span><span class="hl std">(hrdata)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 14999
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#seperating the quantitative and qualitative data</span>

<span class="hl std">hrquant</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;satisfaction_level&quot;</span><span class="hl std">,</span><span class="hl str">&quot;last_evaluation&quot;</span><span class="hl std">,</span><span class="hl str">&quot;number_project&quot;</span>
            <span class="hl std">,</span><span class="hl str">&quot;average_montly_hours&quot;</span><span class="hl std">,</span><span class="hl str">&quot;time_spend_company&quot;</span><span class="hl std">)</span>
<span class="hl std">hrquality</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Work_accident&quot;</span>
              <span class="hl std">,</span><span class="hl str">&quot;left&quot;</span><span class="hl std">,</span><span class="hl str">&quot;promotion_last_5years&quot;</span><span class="hl std">,</span><span class="hl str">&quot;sales&quot;</span><span class="hl std">,</span><span class="hl str">&quot;salary&quot;</span><span class="hl std">)</span>

<span class="hl com">#only quantitative data</span>
<span class="hl std">hrdataquant</span> <span class="hl kwb">=</span><span class="hl std">hrdata[,</span><span class="hl opt">-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">6</span><span class="hl opt">:</span><span class="hl num">10</span><span class="hl std">)]</span>
<span class="hl com">#View(hrdataquant)</span>

<span class="hl com">#Qualitative analysis</span>


<span class="hl com">##Univariate analysis on continous data</span>
<span class="hl std">hrdata</span> <span class="hl opt">%&gt;%</span> <span class="hl kwd">gather</span><span class="hl std">(satisfaction_level</span><span class="hl opt">:</span><span class="hl std">time_spend_company,</span> <span class="hl kwc">key</span> <span class="hl std">=</span> <span class="hl str">&quot;variable&quot;</span><span class="hl std">,</span> <span class="hl kwc">value</span> <span class="hl std">=</span> <span class="hl str">&quot;value&quot;</span><span class="hl std">)</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">ggplot</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= value))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_histogram</span><span class="hl std">(</span><span class="hl kwc">bins</span> <span class="hl std">=</span> <span class="hl num">30</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span> <span class="hl std">variable,</span> <span class="hl kwc">scales</span> <span class="hl std">=</span> <span class="hl str">'free_x'</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-1.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl std">hrdata</span> <span class="hl opt">%&gt;%</span> <span class="hl kwd">gather</span><span class="hl std">(satisfaction_level</span><span class="hl opt">:</span><span class="hl std">time_spend_company,</span> <span class="hl kwc">key</span> <span class="hl std">=</span> <span class="hl str">&quot;variable&quot;</span><span class="hl std">,</span> <span class="hl kwc">value</span> <span class="hl std">=</span> <span class="hl str">&quot;value&quot;</span><span class="hl std">)</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">ggplot</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=variable,</span><span class="hl kwc">y</span> <span class="hl std">= value))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_boxplot</span><span class="hl std">()</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span> <span class="hl std">variable,</span> <span class="hl kwc">scales</span> <span class="hl std">=</span> <span class="hl str">'free_y'</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-2.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#time_spend_company is right skewed with outliers.</span>

<span class="hl kwd">boxplot</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">time_spend_company,</span> <span class="hl kwc">main</span><span class="hl std">=</span><span class="hl str">&quot;time_spend_company&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span><span class="hl str">&quot;green&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-3.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">boxplot</span><span class="hl std">(</span><span class="hl kwd">sqrt</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">time_spend_company),</span> <span class="hl kwc">main</span><span class="hl std">=</span><span class="hl str">&quot;sqrt time_spend_company&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-4.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">boxplot</span><span class="hl std">(</span><span class="hl kwd">log</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">time_spend_company),</span> <span class="hl kwc">main</span><span class="hl std">=</span><span class="hl str">&quot;log time_spend_company&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span><span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-5.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#we will see later on if we require the transformed data to build better</span>
<span class="hl com"># logistic models, as of now going with the original data.</span>

<span class="hl com">#individual histogram</span>
<span class="hl kwa">for</span><span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(hrdataquant))</span>
<span class="hl std">{</span> <span class="hl kwa">if</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl std">(</span><span class="hl kwd">is.factor</span><span class="hl std">(hrdataquant[,i])))</span>
<span class="hl std">{</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">ggplot</span><span class="hl std">(hrdataquant,</span><span class="hl kwd">aes</span><span class="hl std">(hrdataquant[,i]))</span><span class="hl opt">+</span><span class="hl kwd">geom_histogram</span><span class="hl std">()</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl kwd">colnames</span><span class="hl std">(hrdataquant)[i]))</span>

<span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-6.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-7.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-8.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-9.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-10.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#in one sheet to give better presentation of data</span>
<span class="hl kwd">boxplot</span><span class="hl std">(hrdataquant)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-11.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">## Qualitative variables </span>
<span class="hl com"># table shows the frequency of categories in the dependent variable</span>
<span class="hl kwd">table</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##     0     1 
## 11428  3571
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">promotion_last_5years)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##     0     1 
## 14680   319
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">salary)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##   high    low medium 
##   1237   7316   6446
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">sales)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##  accounting          hr          IT  management   marketing product_mng 
##         767         739        1227         630         858         902 
##       RandD       sales     support   technical 
##         787        4140        2229        2720
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">Work_accident)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##     0     1 
## 12830  2169
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">hrdata</span> <span class="hl opt">%&gt;%</span> <span class="hl kwd">gather</span><span class="hl std">(Work_accident</span><span class="hl opt">:</span><span class="hl std">salary,</span> <span class="hl kwc">key</span> <span class="hl std">=</span> <span class="hl str">&quot;variable&quot;</span><span class="hl std">,</span> <span class="hl kwc">value</span> <span class="hl std">=</span> <span class="hl str">&quot;value&quot;</span><span class="hl std">)</span> <span class="hl opt">%&gt;%</span> <span class="hl kwd">ggplot</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= value))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_bar</span><span class="hl std">()</span><span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">variable,</span> <span class="hl kwc">scales</span> <span class="hl std">=</span> <span class="hl str">'free_x'</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-12.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span><span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(hrdataquant))</span>
<span class="hl std">{</span> <span class="hl kwa">if</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl std">(</span><span class="hl kwd">is.factor</span><span class="hl std">(hrdataquant[,i])))</span>
<span class="hl std">{</span>
<span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdataquant[,i],</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">left)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;Left&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl kwd">colnames</span><span class="hl std">(hrdataquant)[i]))</span>
<span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-13.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-14.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-15.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-16.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-17.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span><span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(hrdataquant))</span>
<span class="hl std">{</span> <span class="hl kwa">if</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl std">(</span><span class="hl kwd">is.factor</span><span class="hl std">(hrdataquant[,i])))</span>
<span class="hl std">{</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdataquant[,i],</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">Work_accident)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;Work Accident&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl kwd">colnames</span><span class="hl std">(hrdataquant)[i]))</span>
<span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-18.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-19.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-20.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-21.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-22.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span><span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(hrdataquant))</span>
<span class="hl std">{</span> <span class="hl kwa">if</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl std">(</span><span class="hl kwd">is.factor</span><span class="hl std">(hrdataquant[,i])))</span>
<span class="hl std">{</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdataquant[,i],</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">promotion_last_5years)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;promotion_last_5years&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl kwd">colnames</span><span class="hl std">(hrdataquant)[i]))</span>
<span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-23.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-24.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-25.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-26.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-27.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span><span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(hrdataquant))</span>
<span class="hl std">{</span> <span class="hl kwa">if</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl std">(</span><span class="hl kwd">is.factor</span><span class="hl std">(hrdataquant[,i])))</span>
<span class="hl std">{</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdataquant[,i],</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">sales)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;sales&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl kwd">colnames</span><span class="hl std">(hrdataquant)[i]))</span>
<span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-28.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-29.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-30.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-31.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-32.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#below graph shows that there are people leaving the orgranisation have majority of </span>
<span class="hl com">#people having satisfaction level above 50%...which is strange.</span>
<span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdata</span><span class="hl opt">$</span><span class="hl std">sales,</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">left)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;sales&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl str">&quot;Left Count&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-33.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdata</span><span class="hl opt">$</span><span class="hl std">sales,</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">Work_accident)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;sales&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl str">&quot;Work_accident Count&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-34.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdata</span><span class="hl opt">$</span><span class="hl std">sales,</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">promotion_last_5years)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;sales&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl str">&quot;promotion_last_5years Count&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-35.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdata</span><span class="hl opt">$</span><span class="hl std">sales,</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">salary)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;sales&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl str">&quot;salary Count&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-36.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">qplot</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=hrdata</span><span class="hl opt">$</span><span class="hl std">last_evaluation,</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">),</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl kwd">I</span><span class="hl std">(</span><span class="hl str">&quot;red&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">facet_wrap</span><span class="hl std">(</span><span class="hl opt">~</span><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="message"><pre class="knitr r">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-37.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span><span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(hrdataquant))</span>
<span class="hl std">{</span> <span class="hl kwa">if</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl std">(</span><span class="hl kwd">is.factor</span><span class="hl std">(hrdataquant[,i])))</span>
<span class="hl std">{</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">ggplot</span><span class="hl std">(hrdata,</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= sales ,</span> <span class="hl kwc">y</span> <span class="hl std">=hrdataquant[,i]))</span><span class="hl opt">+</span><span class="hl kwd">geom_bar</span><span class="hl std">(</span><span class="hl kwc">stat</span><span class="hl std">=</span><span class="hl str">&quot;identity&quot;</span><span class="hl std">)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;Sales&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl kwd">colnames</span><span class="hl std">(hrdataquant)[i]))</span>

<span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-38.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rimage default"><img src="figure/unnamed-chunk-1-39.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rimage default"><img src="figure/unnamed-chunk-1-40.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rimage default"><img src="figure/unnamed-chunk-1-41.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rimage default"><img src="figure/unnamed-chunk-1-42.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#more number of people are from sales, support and technical department</span>
<span class="hl com">#employees from sales, support and technical department have recieved the last evaluations</span>
<span class="hl com">#major contribution of project is from sales, support and technical departement</span>
<span class="hl com">#avg monthy hours and time spend in the company are also more for these three departments</span>
<span class="hl com">#accident in work is also more in these department.</span>
<span class="hl com">#and they are one who leaves the company more, sales being the highest.</span>
<span class="hl com">#sales, management and marketing are the ones who have contributes in getting</span>
<span class="hl com">#promotion in last 5 years</span>

<span class="hl kwa">for</span><span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(hrdataquant))</span>
<span class="hl std">{</span> <span class="hl kwa">if</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl std">(</span><span class="hl kwd">is.factor</span><span class="hl std">(hrdataquant[,i])))</span>
<span class="hl std">{</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">ggplot</span><span class="hl std">(hrdata,</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= salary ,</span> <span class="hl kwc">y</span> <span class="hl std">=hrdataquant[,i]))</span><span class="hl opt">+</span><span class="hl kwd">geom_bar</span><span class="hl std">(</span><span class="hl kwc">stat</span><span class="hl std">=</span><span class="hl str">&quot;identity&quot;</span><span class="hl std">)</span><span class="hl opt">+</span><span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl str">&quot;Salary&quot;</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl kwd">colnames</span><span class="hl std">(hrdataquant)[i]))</span>

<span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-43.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rimage default"><img src="figure/unnamed-chunk-1-44.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rimage default"><img src="figure/unnamed-chunk-1-45.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rimage default"><img src="figure/unnamed-chunk-1-46.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rimage default"><img src="figure/unnamed-chunk-1-47.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#clear</span>
<span class="hl com">#boxplot(formula=retail_raw[,i]~retail_raw$Sale.Made,data=retail_raw, ylab=colnames(retail_raw)[i])+labs(caption=&quot;ye&quot;)</span>

<span class="hl kwd">plot</span><span class="hl std">(hrdata[,hrquant])</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-48.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#cor(hrdata[,hrquant])</span>
<span class="hl com">#there is no need to check the collinearlity between x and y</span>
<span class="hl kwd">library</span><span class="hl std">(car)</span>

<span class="hl com">#scatterplot.matrix(hrdataquant) #taking too much time</span>
<span class="hl com">#library(corrgram)</span>
<span class="hl com">#library(corrplot)</span>
<span class="hl com">#corrgram(hrdataquant)</span>
<span class="hl com">#corrplot(cor(hrdataquant),method=&quot;number&quot;)</span>
<span class="hl com">#correlation does show some negative relation between left and word_accident,also</span>
<span class="hl com">#some positive relation between left and time_spend, though the relations are not</span>
<span class="hl com">#strong enough to comment as of now. we will dive deep going forward.</span>

<span class="hl kwd">ggplot</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= hrdata,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= hrdata</span><span class="hl opt">$</span><span class="hl std">left,</span> <span class="hl kwc">fill</span> <span class="hl std">= hrdata</span><span class="hl opt">$</span><span class="hl std">sales))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_bar</span><span class="hl std">()</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-49.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># ggplot(data = TTM, aes(x = Type.of.Behavior, y = Sample.Size, fill = Stage.of.Change)) + </span>
<span class="hl com">#   geom_bar() + coord_flip()</span>
<span class="hl com"># </span>
<span class="hl com"># df %&gt;% </span>
<span class="hl com">#   gather(variable, value, F1:F3) %&gt;% </span>
<span class="hl com">#   ggplot(aes(x = Rank, y = value, fill = variable)) + </span>
<span class="hl com">#   geom_bar(stat = &quot;identity&quot;)</span>


<span class="hl com"># Base on above analysis we will build logistic model to see which employee will</span>
<span class="hl com"># leave the organization.</span>

<span class="hl com">#check if response variable is of factor type or not</span>
<span class="hl kwd">class</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;integer&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#it is integer, lets convert it into factor.</span>

<span class="hl com">#########################################################################</span>
<span class="hl com">##########################Model Building#################################</span>

<span class="hl com">#Start building the basic naive model for the benchmark.</span>
<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">777</span><span class="hl std">)</span>
<span class="hl com"># we will subset based on categories - after basic model</span>
<span class="hl std">rownumbers</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sample</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(hrdata),</span><span class="hl num">0.75</span><span class="hl opt">*</span><span class="hl kwd">nrow</span><span class="hl std">(hrdata))</span>
<span class="hl std">hrtrain</span> <span class="hl kwb">&lt;-</span> <span class="hl std">hrdata[rownumbers,]</span>
<span class="hl std">hrtest</span> <span class="hl kwb">&lt;-</span> <span class="hl std">hrdata[</span><span class="hl opt">-</span><span class="hl std">rownumbers,]</span>

<span class="hl kwd">nrow</span><span class="hl std">(hrtrain)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 11249
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(hrtrain</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##    0    1 
## 8616 2633
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 3750
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##    0    1 
## 2812  938
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#will calculate percentage ratio of 0 and 1</span>

<span class="hl std">glmmodel</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">glm</span><span class="hl std">(</span><span class="hl kwc">formula</span> <span class="hl std">= left</span><span class="hl opt">~</span><span class="hl std">.,</span><span class="hl kwc">family</span> <span class="hl std">=</span> <span class="hl str">&quot;binomial&quot;</span><span class="hl std">,</span><span class="hl kwc">data</span> <span class="hl std">= hrtrain)</span>
<span class="hl kwd">summary</span><span class="hl std">(glmmodel)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## Call:
## glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1646  -0.6582  -0.4009  -0.1329   3.0108  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)           -1.3962973  0.2263106  -6.170 6.84e-10 ***
## satisfaction_level    -4.2471786  0.1145470 -37.078  &lt; 2e-16 ***
## last_evaluation        0.7884126  0.1731555   4.553 5.28e-06 ***
## number_project        -0.3067882  0.0246311 -12.455  &lt; 2e-16 ***
## average_montly_hours   0.0039395  0.0005934   6.639 3.15e-11 ***
## time_spend_company     0.2487930  0.0179574  13.855  &lt; 2e-16 ***
## Work_accident         -1.4673914  0.1020736 -14.376  &lt; 2e-16 ***
## promotion_last_5years -1.2055708  0.2849986  -4.230 2.34e-05 ***
## saleshr                0.3431734  0.1525328   2.250  0.02446 *  
## salesIT               -0.0667481  0.1423662  -0.469  0.63918    
## salesmanagement       -0.2545218  0.1843702  -1.380  0.16743    
## salesmarketing        -0.0342590  0.1552657  -0.221  0.82537    
## salesproduct_mng      -0.0367359  0.1521276  -0.241  0.80918    
## salesRandD            -0.4725524  0.1689924  -2.796  0.00517 ** 
## salessales             0.0220734  0.1203826   0.183  0.85452    
## salessupport           0.0851803  0.1280735   0.665  0.50599    
## salestechnical         0.1318381  0.1249850   1.055  0.29150    
## salarylow              1.9260461  0.1493075  12.900  &lt; 2e-16 ***
## salarymedium           1.4092432  0.1501477   9.386  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 12242.1  on 11248  degrees of freedom
## Residual deviance:  9552.9  on 11230  degrees of freedom
## AIC: 9590.9
## 
## Number of Fisher Scoring iterations: 5
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#Some of the department are not significant as per the GLM model</span>
<span class="hl com">#Deviance is a measure of goodness of fit of a generalized linear model</span>
<span class="hl com">#Or rather, it's a measure of badness of fit-higher numbers indicate worse fit.</span>
<span class="hl com">#he null deviance shows how well the response variable is </span>
<span class="hl com">#predicted by a model that includes only the intercept (grand mean)</span>
<span class="hl com">#There is not a good gap between Null Deviance and Residual Deviance,</span>
<span class="hl com"># thus this is not a good fit, though we will do validation further.</span>


<span class="hl com">#Checking the multicollinearity in the data</span>
<span class="hl kwd">library</span><span class="hl std">(usdm)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'usdm' was built under R version 3.4.1
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: sp
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'sp' was built under R version 3.4.3
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: raster
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'raster' was built under R version 3.4.3
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'raster'
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:dplyr':
## 
##     select
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:tidyr':
## 
##     extract
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'usdm'
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:car':
## 
##     vif
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">vifstep</span><span class="hl std">(hrtrain[,</span><span class="hl opt">-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">9</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">)],</span><span class="hl kwc">th</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## No variable from the 8 input variables has collinearity problem. 
## 
## The linear correlation coefficients ranges between: 
## min correlation ( left ~ last_evaluation ):  0.0007530489 
## max correlation ( average_montly_hours ~ number_project ):  0.4000562 
## 
## ---------- VIFs of the remained variables -------- 
##               Variables      VIF
## 1    satisfaction_level 1.247208
## 2       last_evaluation 1.223596
## 3        number_project 1.342240
## 4  average_montly_hours 1.257949
## 5    time_spend_company 1.079428
## 6         Work_accident 1.024341
## 7                  left 1.233451
## 8 promotion_last_5years 1.013378
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#there is no issue of multicollinearty in the data.</span>


<span class="hl com">#lets see if we get something better from AIC</span>
<span class="hl kwd">library</span><span class="hl std">(MASS)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'MASS' was built under R version 3.4.3
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'MASS'
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:raster':
## 
##     area, select
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:dplyr':
## 
##     select
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">glmaicmodel</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">stepAIC</span><span class="hl std">(glmmodel,</span><span class="hl kwc">direction</span> <span class="hl std">=</span> <span class="hl str">&quot;both&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Start:  AIC=9590.94
## left ~ satisfaction_level + last_evaluation + number_project + 
##     average_montly_hours + time_spend_company + Work_accident + 
##     promotion_last_5years + sales + salary
## 
##                         Df Deviance     AIC
## &lt;none&gt;                       9552.9  9590.9
## - sales                  9   9587.6  9607.6
## - last_evaluation        1   9573.8  9609.8
## - promotion_last_5years  1   9575.6  9611.6
## - average_montly_hours   1   9597.4  9633.4
## - number_project         1   9714.6  9750.6
## - time_spend_company     1   9740.4  9776.4
## - Work_accident          1   9821.2  9857.2
## - salary                 2   9833.1  9867.1
## - satisfaction_level     1  11248.0 11284.0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">glmaicmodel</span><span class="hl opt">$</span><span class="hl std">anova</span>
</pre></div>
<div class="output"><pre class="knitr r">## Stepwise Model Path 
## Analysis of Deviance Table
## 
## Initial Model:
## left ~ satisfaction_level + last_evaluation + number_project + 
##     average_montly_hours + time_spend_company + Work_accident + 
##     promotion_last_5years + sales + salary
## 
## Final Model:
## left ~ satisfaction_level + last_evaluation + number_project + 
##     average_montly_hours + time_spend_company + Work_accident + 
##     promotion_last_5years + sales + salary
## 
## 
##   Step Df Deviance Resid. Df Resid. Dev      AIC
## 1                      11230   9552.943 9590.943
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#It gives the same model as earlier model- no change</span>
<span class="hl kwd">summary</span><span class="hl std">(glmmodel)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## Call:
## glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1646  -0.6582  -0.4009  -0.1329   3.0108  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)           -1.3962973  0.2263106  -6.170 6.84e-10 ***
## satisfaction_level    -4.2471786  0.1145470 -37.078  &lt; 2e-16 ***
## last_evaluation        0.7884126  0.1731555   4.553 5.28e-06 ***
## number_project        -0.3067882  0.0246311 -12.455  &lt; 2e-16 ***
## average_montly_hours   0.0039395  0.0005934   6.639 3.15e-11 ***
## time_spend_company     0.2487930  0.0179574  13.855  &lt; 2e-16 ***
## Work_accident         -1.4673914  0.1020736 -14.376  &lt; 2e-16 ***
## promotion_last_5years -1.2055708  0.2849986  -4.230 2.34e-05 ***
## saleshr                0.3431734  0.1525328   2.250  0.02446 *  
## salesIT               -0.0667481  0.1423662  -0.469  0.63918    
## salesmanagement       -0.2545218  0.1843702  -1.380  0.16743    
## salesmarketing        -0.0342590  0.1552657  -0.221  0.82537    
## salesproduct_mng      -0.0367359  0.1521276  -0.241  0.80918    
## salesRandD            -0.4725524  0.1689924  -2.796  0.00517 ** 
## salessales             0.0220734  0.1203826   0.183  0.85452    
## salessupport           0.0851803  0.1280735   0.665  0.50599    
## salestechnical         0.1318381  0.1249850   1.055  0.29150    
## salarylow              1.9260461  0.1493075  12.900  &lt; 2e-16 ***
## salarymedium           1.4092432  0.1501477   9.386  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 12242.1  on 11248  degrees of freedom
## Residual deviance:  9552.9  on 11230  degrees of freedom
## AIC: 9590.9
## 
## Number of Fisher Scoring iterations: 5
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># The logistic regression coefficients give the change in the log odds of the </span>
<span class="hl com"># outcome for a unit increase in the predictor variable.	</span>
<span class="hl com"># The indicator variables for Sales Departments have a slightly different interpretation. </span>
<span class="hl com"># For example, having Employee from HR Department versus the Employee from </span>
<span class="hl com"># Accounting(baseline) Department , changes the log odds of leaving the company </span>
<span class="hl com"># by 0.343, i.e changes the odds of leaving the company by 1.41 , so the </span>
<span class="hl com"># probability of HR employee leaving the company is 58.5%  as compared to Accounting employee										</span>
<span class="hl com">##Note that while R produces it, the odds ratio for the intercept is not generally interpreted.</span>


<span class="hl com">#calculate the odds ratios for each preditor.</span>
<span class="hl kwd">exp</span><span class="hl std">((glmmodel</span><span class="hl opt">$</span><span class="hl std">coefficients))</span>
</pre></div>
<div class="output"><pre class="knitr r">##           (Intercept)    satisfaction_level       last_evaluation 
##            0.24751173            0.01430454            2.19990144 
##        number_project  average_montly_hours    time_spend_company 
##            0.73580643            1.00394723            1.28247651 
##         Work_accident promotion_last_5years               saleshr 
##            0.23052605            0.29952100            1.40941313 
##               salesIT       salesmanagement        salesmarketing 
##            0.93543076            0.77528713            0.96632119 
##      salesproduct_mng            salesRandD            salessales 
##            0.96393067            0.62340903            1.02231882 
##          salessupport        salestechnical             salarylow 
##            1.08891343            1.14092359            6.86232349 
##          salarymedium 
##            4.09285675
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">perunitpercentchange</span><span class="hl kwb">&lt;-</span><span class="hl num">100</span><span class="hl opt">/</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">+</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">glmmodel</span><span class="hl opt">$</span><span class="hl std">coefficients))</span>
<span class="hl std">perunitpercentchange</span>
</pre></div>
<div class="output"><pre class="knitr r">##           (Intercept)    satisfaction_level       last_evaluation 
##              19.84043               1.41028              68.74904 
##        number_project  average_montly_hours    time_spend_company 
##              42.38989              50.09849              56.18794 
##         Work_accident promotion_last_5years               saleshr 
##              18.73394              23.04857              58.49612 
##               salesIT       salesmanagement        salesmarketing 
##              48.33192              43.67108              49.14361 
##      salesproduct_mng            salesRandD            salessales 
##              49.08171              38.40123              50.55181 
##          salessupport        salestechnical             salarylow 
##              52.12822              53.29119              87.28111 
##          salarymedium 
##              80.36465
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#satisfaction_level - there will be decrease of 1.41% of the employee</span>
<span class="hl com"># leaving the company with every unit increase of satisfaction level.</span>
<span class="hl com">#last_evaluation - Employee leaving the company by 68.74% with every </span>
<span class="hl com"># unit of increase in last_evaluation.</span>

<span class="hl com">## odds ratios and 95% CI</span>
<span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl kwd">cbind</span><span class="hl std">(</span><span class="hl kwc">OR</span><span class="hl std">=glmmodel</span><span class="hl opt">$</span><span class="hl std">coefficients,</span><span class="hl kwd">confint</span><span class="hl std">(glmmodel)))</span>
</pre></div>
<div class="message"><pre class="knitr r">## Waiting for profiling to be done...
</pre></div>
<div class="output"><pre class="knitr r">##                               OR      2.5 %     97.5 %
## (Intercept)           0.24751173 0.15806419 0.38399717
## satisfaction_level    0.01430454 0.01141034 0.01787833
## last_evaluation       2.19990144 1.56739067 3.09027958
## number_project        0.73580643 0.70099250 0.77205948
## average_montly_hours  1.00394723 1.00278222 1.00511766
## time_spend_company    1.28247651 1.23811962 1.32844022
## Work_accident         0.23052605 0.18797975 0.28054561
## promotion_last_5years 0.29952100 0.16539778 0.50869940
## saleshr               1.40941313 1.04555126 1.90163345
## salesIT               0.93543076 0.70810150 1.23755352
## salesmanagement       0.77528713 0.53850001 1.11000420
## salesmarketing        0.96632119 0.71264850 1.31015825
## salesproduct_mng      0.96393067 0.71535627 1.29905524
## salesRandD            0.62340903 0.44671751 0.86680956
## salessales            1.02231882 0.80894684 1.29706057
## salessupport          1.08891343 0.84845422 1.40202766
## salestechnical        1.14092359 0.89452793 1.46037693
## salarylow             6.86232349 5.16240991 9.27724125
## salarymedium          4.09285675 3.07324544 5.54114539
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We can use the confint function to obtain confidence intervals for the </span>
<span class="hl com"># coefficient estimates. Note that for logistic models, confidence intervals </span>
<span class="hl com"># are based on the profiled log-likelihood function. We can also get CIs based </span>
<span class="hl com"># on just the standard errors by using the default method.</span>

<span class="hl com">## CIs using profiled log-likelihood</span>
<span class="hl kwd">confint</span><span class="hl std">(glmmodel)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Waiting for profiling to be done...
</pre></div>
<div class="output"><pre class="knitr r">##                             2.5 %       97.5 %
## (Intercept)           -1.84475403 -0.957120105
## satisfaction_level    -4.47323506 -4.024166026
## last_evaluation        0.44941224  1.128261566
## number_project        -0.35525809 -0.258693679
## average_montly_hours   0.00277836  0.005104614
## time_spend_company     0.21359379  0.284005487
## Work_accident         -1.67142106 -1.271018950
## promotion_last_5years -1.79940190 -0.675898000
## saleshr                0.04454427  0.642713227
## salesIT               -0.34516783  0.213136461
## salesmanagement       -0.61896777  0.104363795
## salesmarketing        -0.33876696  0.270147933
## salesproduct_mng      -0.33497459  0.261637260
## salesRandD            -0.80582884 -0.142935976
## salessales            -0.21202207  0.260100601
## salessupport          -0.16433915  0.337919517
## salestechnical        -0.11145915  0.378694575
## salarylow              1.64140351  2.227564223
## salarymedium           1.12273415  1.712201228
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">## CIs using standard errors</span>
<span class="hl kwd">confint.default</span><span class="hl std">(glmmodel)</span>
</pre></div>
<div class="output"><pre class="knitr r">##                              2.5 %       97.5 %
## (Intercept)           -1.839857929 -0.952736675
## satisfaction_level    -4.471686500 -4.022670648
## last_evaluation        0.449034100  1.127791022
## number_project        -0.355064216 -0.258512186
## average_montly_hours   0.002776494  0.005102428
## time_spend_company     0.213597064  0.283988899
## Work_accident         -1.667451919 -1.267330857
## promotion_last_5years -1.764157789 -0.646983715
## saleshr                0.044214662  0.642132127
## salesIT               -0.345780842  0.212284545
## salesmanagement       -0.615880826  0.106837176
## salesmarketing        -0.338574207  0.270056200
## salesproduct_mng      -0.334900539  0.261428735
## salesRandD            -0.803771407 -0.141333441
## salessales            -0.213872170  0.258018963
## salessupport          -0.165839157  0.336199841
## salestechnical        -0.113128038  0.376804239
## salarylow              1.633408830  2.218683342
## salarymedium           1.114959081  1.703527317
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#model2 &lt;- train(left~.,data = hrtrain,method = &quot;glm&quot;,family=&quot;binomial&quot;)</span>
<span class="hl com">#model2$finalModel</span>
<span class="hl com">#model1$coefficients</span>
<span class="hl com"># Prediction/Evaluation of the glmmodel</span>

<span class="hl com">##1. Accuracy of the glmmodel</span>
<span class="hl std">glmpredict</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">predict</span><span class="hl std">(</span><span class="hl kwc">object</span> <span class="hl std">= glmmodel,</span><span class="hl kwc">newdata</span> <span class="hl std">= hrtest,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;response&quot;</span><span class="hl std">)</span>
<span class="hl std">glmclass</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(glmpredict</span><span class="hl opt">&gt;</span><span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl kwd">table</span><span class="hl std">(glmclass,hrtest</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">##         
## glmclass    0    1
##        0 2602  600
##        1  210  338
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Accuracy of glm model with 0.5 as cutoff&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Accuracy of glm model with 0.5 as cutoff
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,glmclass)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.784
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># cat(&quot;Miss classification Error&quot;)</span>
<span class="hl com"># misClassError(hrtest$left, glmpredict)</span>
<span class="hl com"># #quite high misclassificaiton</span>

<span class="hl kwd">library</span><span class="hl std">(InformationValue)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'InformationValue' was built under R version 3.4.4
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">optCutOff</span><span class="hl kwb">&lt;-</span> <span class="hl kwd">optimalCutoff</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left, glmpredict)[</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">optCutOff</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.4239428
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">glmclass</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(glmpredict</span><span class="hl opt">&gt;</span><span class="hl std">optCutOff,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl kwd">table</span><span class="hl std">(glmclass,hrtest</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">##         
## glmclass    0    1
##        0 2530  453
##        1  282  485
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Accuracy of glm model with optCutOff as cutoff&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Accuracy of glm model with optCutOff as cutoff
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,glmclass)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.804
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Miss classification Error with optimal cutoff&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Miss classification Error with optimal cutoff
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">misClassError</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left, glmpredict,</span> <span class="hl kwc">threshold</span> <span class="hl std">= optCutOff)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.196
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#quite high misclassificaiton</span>

<span class="hl kwd">library</span><span class="hl std">(caret)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'caret' was built under R version 3.4.3
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: lattice
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'caret'
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:InformationValue':
## 
##     confusionMatrix, precision, sensitivity, specificity
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:purrr':
## 
##     lift
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">confusionMatrix</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(glmclass,hrtest</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">dnn</span><span class="hl std">=</span><span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;Predicted&quot;</span><span class="hl std">,</span><span class="hl str">&quot;Actual&quot;</span><span class="hl std">)))</span>
</pre></div>
<div class="output"><pre class="knitr r">## Confusion Matrix and Statistics
## 
##          Actual
## Predicted    0    1
##         0 2530  453
##         1  282  485
##                                           
##                Accuracy : 0.804           
##                  95% CI : (0.7909, 0.8166)
##     No Information Rate : 0.7499          
##     P-Value [Acc &gt; NIR] : 2.277e-15       
##                                           
##                   Kappa : 0.4437          
##  Mcnemar's Test P-Value : 3.598e-10       
##                                           
##             Sensitivity : 0.8997          
##             Specificity : 0.5171          
##          Pos Pred Value : 0.8481          
##          Neg Pred Value : 0.6323          
##              Prevalence : 0.7499          
##          Detection Rate : 0.6747          
##    Detection Prevalence : 0.7955          
##       Balanced Accuracy : 0.7084          
##                                           
##        'Positive' Class : 0               
## 
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#So the accuracy of our glm model is 80.4%, as we have calculated from</span>
<span class="hl com"># different method above.</span>

<span class="hl com">##2. Goodness of Fit - Hosmer Lemeshow Test</span>


<span class="hl kwd">library</span><span class="hl std">(ResourceSelection)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'ResourceSelection' was built under R version 3.4.4
</pre></div>
<div class="message"><pre class="knitr r">## ResourceSelection 0.3-2 	 2017-02-28
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">hoslem.test</span><span class="hl std">(hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwd">fitted</span><span class="hl std">(glmmodel),</span><span class="hl kwc">g</span><span class="hl std">=</span><span class="hl num">10</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## 	Hosmer and Lemeshow goodness of fit (GOF) test
## 
## data:  hrtrain$left, fitted(glmmodel)
## X-squared = 241.01, df = 8, p-value &lt; 2.2e-16
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#since p-value is less than 0.05, so we reject the null hypothesis, i.e </span>
<span class="hl com"># the current model is not a good fit as shown by Hosmer &amp; Lemeshow test.</span>

<span class="hl com">##3. evaluate the statistical significance of each coffecient in the model</span>
<span class="hl com"># - Wald test</span>
<span class="hl com"># h0: - coffecients are zeros/insignificant</span>
<span class="hl com"># h1 :- coffecients of the independent variabe in the model is significantly</span>
<span class="hl com"># different from 0.</span>
<span class="hl com">#if the test fails to reject the null  hypothesis ,this suggests that</span>
<span class="hl com"># removing the variable from the model  will not  substantially harm the </span>
<span class="hl com"># fit of the model.</span>


<span class="hl kwd">library</span><span class="hl std">(survey)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'survey' was built under R version 3.4.3
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: grid
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: Matrix
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'Matrix'
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:tidyr':
## 
##     expand
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: survival
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'survival'
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:caret':
## 
##     cluster
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'survey'
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:raster':
## 
##     cv
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:graphics':
## 
##     dotchart
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#regTermTest(glmmodel,&quot;satisfaction_level&quot;)</span>

<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(hrtrain[,</span><span class="hl opt">-</span><span class="hl num">7</span><span class="hl std">]))){</span>
  <span class="hl kwa">if</span> <span class="hl std">(i</span><span class="hl opt">==</span><span class="hl num">7</span><span class="hl std">){</span>
    <span class="hl com">#cat(&quot;Significance of Response Variable is not required&quot;)</span>
  <span class="hl std">}</span><span class="hl kwa">else</span><span class="hl std">{</span>
  <span class="hl kwd">print</span> <span class="hl std">(</span><span class="hl kwd">regTermTest</span><span class="hl std">(glmmodel,</span><span class="hl kwd">colnames</span><span class="hl std">(hrtrain)[i]))</span>
  <span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Wald test for satisfaction_level
##  in glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## F =  1374.782  on  1  and  11230  df: p= &lt; 2.22e-16 
## Wald test for last_evaluation
##  in glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## F =  20.73169  on  1  and  11230  df: p= 5.339e-06 
## Wald test for number_project
##  in glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## F =  155.1353  on  1  and  11230  df: p= &lt; 2.22e-16 
## Wald test for average_montly_hours
##  in glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## F =  44.07933  on  1  and  11230  df: p= 3.2987e-11 
## Wald test for time_spend_company
##  in glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## F =  191.9499  on  1  and  11230  df: p= &lt; 2.22e-16 
## Wald test for Work_accident
##  in glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## F =  206.6642  on  1  and  11230  df: p= &lt; 2.22e-16 
## Wald test for promotion_last_5years
##  in glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## F =  17.89369  on  1  and  11230  df: p= 2.3545e-05 
## Wald test for sales
##  in glm(formula = left ~ ., family = &quot;binomial&quot;, data = hrtrain)
## F =  3.728433  on  9  and  11230  df: p= 0.00010854
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#All the predictors in the model are significant as per the wald test.</span>
<span class="hl com">#As P-value is less than 0.05 thus we reject null hypothesis, i.e removing</span>
<span class="hl com"># any predictor from the model will harm the fit of the model.</span>


<span class="hl com">## we will use aod package to perform wald test to check overall effect of sales</span>
<span class="hl com">## and salary predictors..</span>
<span class="hl com">#install.packages(&quot;aod&quot;)</span>
<span class="hl kwd">library</span><span class="hl std">(aod)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'aod' was built under R version 3.4.4
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'aod'
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:survival':
## 
##     rats
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">wald.test</span><span class="hl std">(</span><span class="hl kwc">b</span><span class="hl std">=</span><span class="hl kwd">coef</span><span class="hl std">(glmmodel),</span><span class="hl kwc">Sigma</span> <span class="hl std">=</span> <span class="hl kwd">vcov</span><span class="hl std">(glmmodel),</span> <span class="hl kwc">Terms</span> <span class="hl std">=</span> <span class="hl num">9</span><span class="hl opt">:</span><span class="hl num">17</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 33.6, df = 9, P(&gt; X2) = 0.00011
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># The chi-squared test statistic of 33.6, with 9 degrees of freedom is </span>
<span class="hl com"># associated with a p-value of 0.00011 indicating that the overall effect of </span>
<span class="hl com"># Sales is statistically significant.</span>

<span class="hl kwd">wald.test</span><span class="hl std">(</span><span class="hl kwc">b</span><span class="hl std">=</span><span class="hl kwd">coef</span><span class="hl std">(glmmodel),</span><span class="hl kwc">Sigma</span> <span class="hl std">=</span> <span class="hl kwd">vcov</span><span class="hl std">(glmmodel),</span> <span class="hl kwc">Terms</span> <span class="hl std">=</span> <span class="hl num">18</span><span class="hl opt">:</span><span class="hl num">19</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 226.6, df = 2, P(&gt; X2) = 0.0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># The chi-squared test statistic of 226.6, with 2 degrees of freedom is </span>
<span class="hl com"># associated with a p-value of 0.0 indicating that the overall effect of </span>
<span class="hl com"># Salary is statistically significant.</span>

<span class="hl com">## we can also test the difference in the coefficient for the different level</span>
<span class="hl com">## of Sales, like HR and IT</span>

<span class="hl std">hrit</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">cbind</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl com"># deifnes the vector for which we want to test.</span>
<span class="hl com"># To contrast these two terms, we multiply one of them by 1, and the other by </span>
<span class="hl com"># -1. The other terms in the model are not involved in the test, so they are </span>
<span class="hl com"># multiplied by 0. The second line of code below uses L=hrit to tell R that we </span>
<span class="hl com"># wish to base the test on the vector hrit (rather than using the Terms option as </span>
<span class="hl com"># we did above).</span>
<span class="hl kwd">wald.test</span><span class="hl std">(</span><span class="hl kwc">b</span><span class="hl std">=</span><span class="hl kwd">coef</span><span class="hl std">(glmmodel),</span><span class="hl kwc">Sigma</span> <span class="hl std">=</span> <span class="hl kwd">vcov</span><span class="hl std">(glmmodel),</span><span class="hl kwc">L</span><span class="hl std">=hrit)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 8.7, df = 1, P(&gt; X2) = 0.0031
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># The chi-squared test statistic of 8.7 with 1 degree of freedom is associated </span>
<span class="hl com"># with a p-value of 0.0031, indicating that the difference between the coefficient </span>
<span class="hl com"># for Sales=HR and the coefficient for Sales=IT is statistically significant.</span>
<span class="hl com">#This way we can test the difference between anyother coefficients.</span>


<span class="hl com">##4. MC Fadden's R2 Test.</span>
<span class="hl com">#unlike linear regression, there is no R2 statistic which</span>
<span class="hl com"># explains the proportion of variation in the dependent</span>
<span class="hl com"># variable that is explained by the predictors.</span>
<span class="hl com"># for this we use Mc Fadden's R2</span>

<span class="hl com">#install.packages(&quot;pscl&quot;)</span>
<span class="hl kwd">library</span><span class="hl std">(pscl)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'pscl' was built under R version 3.4.4
</pre></div>
<div class="message"><pre class="knitr r">## Classes and Methods for R developed in the
## Political Science Computational Laboratory
## Department of Political Science
## Stanford University
## Simon Jackman
## hurdle and zeroinfl functions by Achim Zeileis
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">pR2</span><span class="hl std">(glmmodel)</span>
</pre></div>
<div class="output"><pre class="knitr r">##           llh       llhNull            G2      McFadden          r2ML 
## -4776.4714983 -6121.0529285  2689.1628603     0.2196651     0.2126307 
##          r2CU 
##     0.3206104
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#McFadden = .2196 </span>
<span class="hl com">#The predictors in our model explain just the 21.96% </span>
<span class="hl com"># variation in the data.</span>
<span class="hl com"># This suggests that one or more variables are missing </span>
<span class="hl com"># in our model</span>

<span class="hl com">#5. ROC</span>
<span class="hl com">#install.packages(&quot;InformationValue&quot;)</span>
<span class="hl kwd">library</span><span class="hl std">(InformationValue)</span>
<span class="hl kwd">plotROC</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">fitted</span><span class="hl std">(glmmodel)))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-50.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#since the area under curve is 82.06, we can say  the correctly identification</span>
<span class="hl com"># ability of our model is good.</span>

<span class="hl com">#6. Kolmogrov Smirnov Chart</span>
<span class="hl com">#measure the performance of classification models.</span>
<span class="hl com"># It is a measure of degree of seperation between left(1) and not-left(0)</span>
<span class="hl com"># Distance between left and not-left should be as large as possible</span>
<span class="hl com">#The random line in the chart corresponds to the case  of capturing the responders(1)</span>
<span class="hl com"># by random selection,i.e  when you dont have any model at disposal.</span>
<span class="hl com">#The model line represent the case of capturing the responders if you go by the model</span>
<span class="hl com"># generated probability scores where you begin by targeting datapoint with </span>
<span class="hl com"># highest probability scores.</span>

<span class="hl kwd">ks_plot</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">fitted</span><span class="hl std">(glmmodel)))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-51.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># as the measure between left and not-left is not so large, we can say that</span>
<span class="hl com"># performance of the model is not good.</span>
<span class="hl com"># Kolmogorv Smirnov statistic is the maximum  difference between the cumulative </span>
<span class="hl com"># true positive and cumulative false positive rate</span>
<span class="hl com"># the hihger the value of kolmogrov statistic,  the more efficient is the </span>
<span class="hl com"># model at capturing the responders(1).</span>
<span class="hl kwd">ks_stat</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">fitted</span><span class="hl std">(glmmodel)))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.5033
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#As the kolmogrov Smirnov statistic is .5033 which is small, we can say </span>
<span class="hl com"># that the model is not that efficient in capturing  the responders(1).</span>

<span class="hl com">#7. F1 score - accuracy test.</span>
<span class="hl std">hrtr</span> <span class="hl kwb">&lt;-</span> <span class="hl std">hrtrain</span>
<span class="hl std">hrtr</span><span class="hl opt">$</span><span class="hl std">fitted_label</span> <span class="hl kwb">&lt;-</span> <span class="hl std">glmmodel</span><span class="hl opt">$</span><span class="hl std">fitted.values</span>
<span class="hl com">#hrtrain$fitted_label &lt;- glmmodel$fitted.values</span>
<span class="hl std">hrtr</span><span class="hl opt">$</span><span class="hl std">fitted_label</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtr</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">&gt;</span><span class="hl std">optCutOff,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">optCutOff</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.4239428
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">tp</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtr</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtr</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">))</span>
<span class="hl std">tp</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 1317
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">fp</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtr</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">0</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtr</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">))</span>
<span class="hl std">fp</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 869
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">prec</span> <span class="hl kwb">=</span> <span class="hl std">tp</span><span class="hl opt">/</span><span class="hl std">(tp</span><span class="hl opt">+</span><span class="hl std">fp)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The precision is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The precision is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">prec</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.6024703
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#tp = sum((hrtrain1$left==1)&amp;(hrtrain1$fitted_label==1))</span>
<span class="hl std">fn</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtr</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtr</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">0</span><span class="hl std">))</span>
<span class="hl std">rec</span> <span class="hl kwb">=</span> <span class="hl std">tp</span><span class="hl opt">/</span><span class="hl std">(tp</span><span class="hl opt">+</span><span class="hl std">fn)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The recall is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The recall is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">rec</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.5001899
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">F1</span> <span class="hl kwb">=</span> <span class="hl num">2</span><span class="hl opt">*</span><span class="hl std">(prec</span><span class="hl opt">*</span><span class="hl std">rec)</span><span class="hl opt">/</span><span class="hl std">(prec</span><span class="hl opt">+</span><span class="hl std">rec)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The F1 score is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The F1 score is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">F1</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.5465864
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#F1 score (also F-score or F-measure) is a measure of a test's accuracy. </span>
<span class="hl com"># It considers both the precision p and the recall r of the test to compute </span>
<span class="hl com"># the score: p is the number of correct positive results divided by the number </span>
<span class="hl com"># of all positive results returned by the classifier, and r is the number of </span>
<span class="hl com"># correct positive results divided by the number of all relevant samples </span>
<span class="hl com"># (all samples that should have been identified as positive). The F1 score </span>
<span class="hl com"># is the harmonic average of the precision and recall, where an F1 score </span>
<span class="hl com"># reaches its best value at 1 (perfect precision and recall) and worst at 0.</span>
<span class="hl com">#This also suggest the test's accuracy of the model is not good.</span>

<span class="hl com">#########################################################################</span>
<span class="hl com">###########################2. Decision Tree##############################</span>
<span class="hl com">#Decision Tree using tree()</span>
<span class="hl com">#install.packages(&quot;tree&quot;)</span>
<span class="hl kwd">library</span><span class="hl std">(tree)</span>
<span class="hl std">hrtrain</span><span class="hl opt">$</span><span class="hl std">salary</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.factor</span><span class="hl std">(hrtrain</span><span class="hl opt">$</span><span class="hl std">salary)</span>
<span class="hl std">hrtrain</span><span class="hl opt">$</span><span class="hl std">sales</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.factor</span><span class="hl std">(hrtrain</span><span class="hl opt">$</span><span class="hl std">sales)</span>
<span class="hl std">hrtrain</span><span class="hl opt">$</span><span class="hl std">left</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.factor</span><span class="hl std">(hrtrain</span><span class="hl opt">$</span><span class="hl std">left)</span>
<span class="hl std">hrtest</span><span class="hl opt">$</span><span class="hl std">left</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.factor</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left)</span>
<span class="hl std">hrtest</span><span class="hl opt">$</span><span class="hl std">salary</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.factor</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">salary)</span>
<span class="hl std">hrtest</span><span class="hl opt">$</span><span class="hl std">sales</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.factor</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">sales)</span>
<span class="hl com">#Build tree on train data</span>

<span class="hl std">DT_Model</span> <span class="hl kwb">=</span> <span class="hl kwd">tree</span><span class="hl std">(left</span><span class="hl opt">~</span><span class="hl std">.,</span><span class="hl kwc">data</span><span class="hl std">=hrtrain)</span>
<span class="hl com">#summary(DT_Model)</span>
<span class="hl com">#predict on test data</span>
<span class="hl std">tree.pred</span> <span class="hl kwb">=</span> <span class="hl kwd">predict</span><span class="hl std">(DT_Model,</span><span class="hl kwc">newdata</span><span class="hl std">=hrtest,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">)</span>

<span class="hl com">#plot the tree to check how the tree model is</span>

<span class="hl kwd">plot</span><span class="hl std">(DT_Model)</span>
<span class="hl kwd">text</span><span class="hl std">(DT_Model,</span><span class="hl kwc">pretty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-52.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#confusion matrix</span>

<span class="hl kwd">table</span><span class="hl std">(tree.pred,hrtest</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">##          
## tree.pred    0    1
##         0 2783   80
##         1   29  858
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left ,tree.pred)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9709333
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#prune a tree using cross validation</span>
<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">1234</span><span class="hl std">)</span>
<span class="hl std">cv_dt_model</span><span class="hl kwb">=</span><span class="hl kwd">cv.tree</span><span class="hl std">(DT_Model,</span><span class="hl kwc">FUN</span><span class="hl std">=prune.misclass)</span>

<span class="hl kwd">plot</span><span class="hl std">(cv_dt_model</span><span class="hl opt">$</span><span class="hl std">size,cv_dt_model</span><span class="hl opt">$</span><span class="hl std">dev,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;b&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-53.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl std">DT_Pruned</span><span class="hl kwb">=</span><span class="hl kwd">prune.misclass</span><span class="hl std">(DT_Model,</span><span class="hl kwc">best</span><span class="hl std">=</span><span class="hl num">8</span><span class="hl std">)</span>
<span class="hl kwd">plot</span><span class="hl std">(DT_Pruned)</span>
<span class="hl kwd">text</span><span class="hl std">(DT_Pruned,</span><span class="hl kwc">pretty</span> <span class="hl std">=</span> <span class="hl num">8</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-54.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#rpart</span>
<span class="hl kwd">library</span><span class="hl std">(rpart)</span>

<span class="hl kwd">library</span><span class="hl std">(rattle)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'rattle' was built under R version 3.4.4
</pre></div>
<div class="message"><pre class="knitr r">## Rattle: A free graphical interface for data science with R.
## Version 5.1.0 Copyright (c) 2006-2017 Togaware Pty Ltd.
## Type 'rattle()' to shake, rattle, and roll your data.
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#install.packages(&quot;rpart.plot&quot;)</span>
<span class="hl kwd">library</span><span class="hl std">(rpart.plot)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'rpart.plot' was built under R version 3.4.4
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">rpartmodel</span><span class="hl kwb">=</span><span class="hl kwd">rpart</span><span class="hl std">(</span><span class="hl kwc">formula</span><span class="hl std">=left</span><span class="hl opt">~</span><span class="hl std">.,</span><span class="hl kwc">data</span><span class="hl std">=hrtrain,</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">,</span>
                 <span class="hl kwc">control</span> <span class="hl std">=</span> <span class="hl kwd">rpart.control</span><span class="hl std">(</span><span class="hl kwc">cp</span> <span class="hl std">=</span> <span class="hl num">0.0</span><span class="hl std">))</span>
<span class="hl com">#summary(rpartmodel)</span>
<span class="hl kwd">windows</span><span class="hl std">()</span>
<span class="hl kwd">fancyRpartPlot</span><span class="hl std">(</span><span class="hl kwc">model</span><span class="hl std">=rpartmodel,</span><span class="hl kwc">main</span><span class="hl std">=</span><span class="hl str">&quot;Hr model&quot;</span><span class="hl std">,</span><span class="hl kwc">cex</span><span class="hl std">=</span><span class="hl num">0.6</span><span class="hl std">)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: labs do not fit even at cex 0.15, there may be some overplotting
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-55.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">printcp</span><span class="hl std">(rpartmodel)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## Classification tree:
## rpart(formula = left ~ ., data = hrtrain, method = &quot;class&quot;, control = rpart.control(cp = 0))
## 
## Variables actually used in tree construction:
## [1] average_montly_hours last_evaluation      number_project      
## [4] salary               sales                satisfaction_level  
## [7] time_spend_company  
## 
## Root node error: 2633/11249 = 0.23407
## 
## n= 11249 
## 
##            CP nsplit rel error   xerror      xstd
## 1  2.5256e-01      0  1.000000 1.000000 0.0170557
## 2  1.8325e-01      1  0.747436 0.747436 0.0153039
## 3  7.0072e-02      3  0.380934 0.380934 0.0114794
## 4  5.6210e-02      5  0.240790 0.242689 0.0093240
## 5  3.2662e-02      6  0.184580 0.186859 0.0082380
## 6  1.7091e-02      7  0.151918 0.156476 0.0075665
## 7  1.2533e-02      8  0.134827 0.138625 0.0071373
## 8  7.2161e-03      9  0.122294 0.124193 0.0067673
## 9  5.6969e-03     10  0.115078 0.120775 0.0066763
## 10 4.9373e-03     11  0.109381 0.112419 0.0064477
## 11 4.1777e-03     12  0.104444 0.105963 0.0062647
## 12 3.7979e-03     13  0.100266 0.103684 0.0061986
## 13 3.0384e-03     14  0.096468 0.100646 0.0061094
## 14 2.2788e-03     15  0.093430 0.097607 0.0060186
## 15 1.8990e-03     16  0.091151 0.097987 0.0060300
## 16 1.5192e-03     17  0.089252 0.097987 0.0060300
## 17 7.5959e-04     18  0.087733 0.095329 0.0059496
## 18 3.0384e-04     22  0.084694 0.096088 0.0059727
## 19 2.8485e-04     28  0.082795 0.097227 0.0060072
## 20 1.8990e-04     32  0.081656 0.098367 0.0060414
## 21 1.2660e-04     34  0.081276 0.099886 0.0060868
## 22 8.4399e-05     40  0.080517 0.099886 0.0060868
## 23 7.5959e-05     49  0.079757 0.100266 0.0060981
## 24 0.0000e+00     54  0.079377 0.102545 0.0061653
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">plotcp</span><span class="hl std">(rpartmodel)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-56.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl std">rpartmodel_test</span><span class="hl kwb">=</span><span class="hl kwd">predict</span><span class="hl std">(</span><span class="hl kwc">object</span><span class="hl std">=rpartmodel,</span><span class="hl kwc">newdata</span><span class="hl std">=hrtest,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">)</span>
<span class="hl com">#mean(rpartmodel_test==hrtest$left)</span>
<span class="hl com">#confusion matrix</span>

<span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left ,rpartmodel_test)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    rpartmodel_test
##        0    1
##   0 2772   40
##   1   59  879
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#model accuracy on test data</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Accuracy of the Decision Tree model is:&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Accuracy of the Decision Tree model is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">baseaccuracy</span><span class="hl kwb">&lt;-</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,rpartmodel_test)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
<span class="hl std">baseaccuracy</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9736
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">##Now we will prune tree to stop the tree at optimum</span>
<span class="hl com">##Pre-prune the tree</span>
<span class="hl std">rpartmodelpre</span><span class="hl kwb">=</span><span class="hl kwd">rpart</span><span class="hl std">(</span><span class="hl kwc">formula</span><span class="hl std">=left</span><span class="hl opt">~</span><span class="hl std">.,</span><span class="hl kwc">data</span><span class="hl std">=hrtrain,</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">,</span>
                 <span class="hl kwc">control</span> <span class="hl std">=</span> <span class="hl kwd">rpart.control</span><span class="hl std">(</span><span class="hl kwc">cp</span> <span class="hl std">=</span> <span class="hl num">0.0</span><span class="hl std">,</span><span class="hl kwc">maxdepth</span> <span class="hl std">=</span> <span class="hl num">9</span><span class="hl std">,</span><span class="hl kwc">minsplit</span> <span class="hl std">=</span> <span class="hl num">100</span><span class="hl std">,</span><span class="hl kwc">minbucket</span> <span class="hl std">=</span> <span class="hl num">20</span><span class="hl std">))</span>
<span class="hl com">#summary(rpartmodelpre)</span>
<span class="hl kwd">windows</span><span class="hl std">()</span>
<span class="hl kwd">fancyRpartPlot</span><span class="hl std">(</span><span class="hl kwc">model</span><span class="hl std">=rpartmodelpre,</span><span class="hl kwc">main</span><span class="hl std">=</span><span class="hl str">&quot;Pre Prune Hr model&quot;</span><span class="hl std">,</span><span class="hl kwc">cex</span><span class="hl std">=</span><span class="hl num">0.6</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-57.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">printcp</span><span class="hl std">(rpartmodelpre)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## Classification tree:
## rpart(formula = left ~ ., data = hrtrain, method = &quot;class&quot;, control = rpart.control(cp = 0, 
##     maxdepth = 9, minsplit = 100, minbucket = 20))
## 
## Variables actually used in tree construction:
## [1] average_montly_hours last_evaluation      number_project      
## [4] satisfaction_level   time_spend_company  
## 
## Root node error: 2633/11249 = 0.23407
## 
## n= 11249 
## 
##           CP nsplit rel error  xerror      xstd
## 1  0.2525636      0   1.00000 1.00000 0.0170557
## 2  0.1832510      1   0.74744 0.74744 0.0153039
## 3  0.0700722      3   0.38093 0.38093 0.0114794
## 4  0.0562096      5   0.24079 0.24421 0.0093513
## 5  0.0326624      6   0.18458 0.18800 0.0082619
## 6  0.0170908      7   0.15192 0.15837 0.0076105
## 7  0.0125332      8   0.13483 0.14014 0.0071750
## 8  0.0072161      9   0.12229 0.12761 0.0068570
## 9  0.0056969     10   0.11508 0.12343 0.0067472
## 10 0.0018990     11   0.10938 0.11812 0.0066045
## 11 0.0011394     12   0.10748 0.11888 0.0066251
## 12 0.0000000     13   0.10634 0.11850 0.0066148
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">plotcp</span><span class="hl std">(rpartmodelpre)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-58.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl std">rpartmodelpre_test</span><span class="hl kwb">=</span><span class="hl kwd">predict</span><span class="hl std">(</span><span class="hl kwc">object</span><span class="hl std">=rpartmodelpre,</span><span class="hl kwc">newdata</span><span class="hl std">=hrtest,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">)</span>
<span class="hl com">#mean(rpartmodel_test==hrtest$left)</span>
<span class="hl com">#confusion matrix</span>

<span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left ,rpartmodelpre_test)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    rpartmodelpre_test
##        0    1
##   0 2801   11
##   1   85  853
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#model accuracy on test data</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Accuracy of the Pre Prune Decision Tree model is:&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Accuracy of the Pre Prune Decision Tree model is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">preaccuracy</span><span class="hl kwb">&lt;-</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,rpartmodelpre_test)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
<span class="hl std">preaccuracy</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9744
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">##Post-Prune the tree</span>
<span class="hl std">rpartmodelpost</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">prune</span><span class="hl std">(rpartmodel,</span><span class="hl kwc">cp</span> <span class="hl std">=</span> <span class="hl num">0.0045</span> <span class="hl std">)</span>
<span class="hl std">rpartmodelpost_test</span><span class="hl kwb">=</span><span class="hl kwd">predict</span><span class="hl std">(</span><span class="hl kwc">object</span><span class="hl std">=rpartmodelpost,</span><span class="hl kwc">newdata</span><span class="hl std">=hrtest,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Accuracy of the Post Prune Decision Tree model is:&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Accuracy of the Post Prune Decision Tree model is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">postaccuracy</span><span class="hl kwb">&lt;-</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,rpartmodelpost_test)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
<span class="hl std">postaccuracy</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9733333
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">data.frame</span><span class="hl std">(baseaccuracy,preaccuracy,postaccuracy)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   baseaccuracy preaccuracy postaccuracy
## 1       0.9736      0.9744    0.9733333
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#so the best model based on decision tree is the pre-pruned Model.</span>

<span class="hl com">##1. Accuracy of the rpartmodelpre</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Accuracy of the Pre Prune Decision Tree model is:&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Accuracy of the Pre Prune Decision Tree model is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">preaccuracy</span><span class="hl kwb">&lt;-</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,rpartmodelpre_test)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
<span class="hl std">preaccuracy</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9744
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#So the accuracy of our Pre-Prune Decision Tree is 97.44%, as we have calculated from</span>
<span class="hl com"># different method above.</span>

<span class="hl com">#2. ROC</span>
<span class="hl std">predicthr</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">predict</span><span class="hl std">(</span><span class="hl kwc">object</span><span class="hl std">=rpartmodelpre,</span><span class="hl kwc">newdata</span><span class="hl std">=hrtrain,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">)</span>
<span class="hl kwd">plotROC</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(predicthr))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-59.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#since the area under curve is 94.88, we can say  the discrimination  ability</span>
<span class="hl com"># of our model is good.</span>

<span class="hl com">#3. Kolmogrov Smirnov Chart</span>
<span class="hl com">#measure the performance of classification models.</span>

<span class="hl kwd">ks_plot</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(predicthr))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-60.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># as the measure between left and not-left is large, we can say that</span>
<span class="hl com"># performance of the model is good.</span>
<span class="hl kwd">ks_stat</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(predicthr))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.8426
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#As the kolmogrov Smirnov statistic is 0.8426 which is good, we can say </span>
<span class="hl com"># that the model is efficient in capturing  the responders(1).</span>

<span class="hl com">#########################################################################</span>
<span class="hl com">##########################Random Forest##################################</span>

<span class="hl kwd">library</span><span class="hl std">(randomForest)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'randomForest' was built under R version 3.4.4
</pre></div>
<div class="message"><pre class="knitr r">## randomForest 4.6-14
</pre></div>
<div class="message"><pre class="knitr r">## Type rfNews() to see new features/changes/bug fixes.
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'randomForest'
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:rattle':
## 
##     importance
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:dplyr':
## 
##     combine
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:ggplot2':
## 
##     margin
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#Random Forest Model 1: default settings</span>
<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">1234</span><span class="hl std">)</span>

<span class="hl std">rfmodel1</span><span class="hl kwb">=</span><span class="hl kwd">randomForest</span><span class="hl std">(left</span><span class="hl opt">~</span><span class="hl std">.,</span><span class="hl kwc">data</span><span class="hl std">=hrtrain)</span>

  <span class="hl com">#importance of each variable</span>
<span class="hl com">#the more the decrease in GIni, the more the importance </span>
<span class="hl com">#of the independednt variable in the prediction the dependent varioable</span>
<span class="hl kwd">varImpPlot</span><span class="hl std">(rfmodel1)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-61.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl std">rf_predict</span><span class="hl kwb">=</span><span class="hl kwd">predict</span><span class="hl std">(</span><span class="hl kwc">object</span><span class="hl std">=rfmodel1,</span><span class="hl kwc">newdata</span><span class="hl std">=hrtest,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;response&quot;</span><span class="hl std">)</span>

<span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,rf_predict)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    rf_predict
##        0    1
##   0 2806    6
##   1   27  911
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">rfbaseaccuracy</span> <span class="hl kwb">&lt;-</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,rf_predict)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Accuracy of the model is&quot;</span> <span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Accuracy of the model is
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">rfbaseaccuracy</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9912
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#remove some insignificant variables and build random forest model again</span>

<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">1000</span><span class="hl std">)</span>

<span class="hl std">rfmodel2</span><span class="hl kwb">=</span><span class="hl kwd">randomForest</span><span class="hl std">(</span><span class="hl kwc">formula</span><span class="hl std">=left</span><span class="hl opt">~</span><span class="hl std">satisfaction_level</span><span class="hl opt">+</span><span class="hl std">number_project</span>
                      <span class="hl opt">+</span><span class="hl std">time_spend_company</span><span class="hl opt">+</span><span class="hl std">average_montly_hours</span><span class="hl opt">+</span><span class="hl std">last_evaluation</span>
                      <span class="hl std">,</span><span class="hl kwc">data</span><span class="hl std">=hrtrain)</span>
<span class="hl kwd">varImpPlot</span><span class="hl std">(rfmodel2)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-62.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl std">rfpredict2</span><span class="hl kwb">=</span><span class="hl kwd">predict</span><span class="hl std">(</span><span class="hl kwc">object</span><span class="hl std">=rfmodel2,</span><span class="hl kwc">newdata</span><span class="hl std">=hrtest,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;response&quot;</span><span class="hl std">)</span>

<span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,rfpredict2)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    rfpredict2
##        0    1
##   0 2805    7
##   1   27  911
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrtest</span><span class="hl opt">$</span><span class="hl std">left,rfpredict2)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtest)</span> <span class="hl com">#99.09%</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9909333
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#2. ROC</span>
<span class="hl std">predicttrainrf</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">predict</span><span class="hl std">(</span><span class="hl kwc">object</span><span class="hl std">=rfmodel2,</span><span class="hl kwc">newdata</span><span class="hl std">=hrtrain,</span><span class="hl kwc">type</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">)</span>
<span class="hl kwd">plotROC</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(predicttrainrf))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-63.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#since the area under curve is 99.87, we can say  the discrimination  ability</span>
<span class="hl com"># of our model is good.</span>

<span class="hl com">#3. Kolmogrov Smirnov Chart</span>
<span class="hl com">#measure the performance of classification models.</span>

<span class="hl kwd">ks_plot</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(predicttrainrf))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-64.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># as the measure between left and not-left is large, we can say that</span>
<span class="hl com"># performance of the model is good.</span>
<span class="hl kwd">ks_stat</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrtrain</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(predicttrainrf))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9134
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#As the kolmogrov Smirnov statistic is 0.9134 which is good, we can say </span>
<span class="hl com"># that the model is efficient in capturing  the responders(1).</span>

<span class="hl com">#so the best algo which provides the correctd prediction is from random forest which is</span>
<span class="hl com">#rfmodel2 with few predictors.</span>


<span class="hl com">###############################################################################</span>
<span class="hl com">############UnRegularized Logistic Regression with optimization################</span>
<span class="hl com">###############################################################################</span>

<span class="hl com">#create dummy variable for categorical variables</span>

<span class="hl std">hrtrain1</span> <span class="hl kwb">&lt;-</span> <span class="hl std">hrtrain</span>
<span class="hl std">hrtest1</span> <span class="hl kwb">&lt;-</span> <span class="hl std">hrtest</span>
<span class="hl std">hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">)</span>
<span class="hl std">hrtest1</span><span class="hl opt">$</span><span class="hl std">left</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtest1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">)</span>
<span class="hl com"># table(hrtrain$left)</span>
<span class="hl com"># table(hrtrain1$left)</span>
<span class="hl com"># table(hrtest1$left)</span>
<span class="hl kwa">for</span><span class="hl std">(level</span> <span class="hl kwa">in</span> <span class="hl kwd">unique</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">sales)){</span>
  <span class="hl std">hrtrain1[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;dummy&quot;</span><span class="hl std">, level,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;_&quot;</span><span class="hl std">)]</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">sales</span> <span class="hl opt">==</span> <span class="hl std">level,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl kwa">for</span><span class="hl std">(level</span> <span class="hl kwa">in</span> <span class="hl kwd">unique</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">salary)){</span>
  <span class="hl std">hrtrain1[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;dummy&quot;</span><span class="hl std">, level,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;_&quot;</span><span class="hl std">)]</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">salary</span> <span class="hl opt">==</span> <span class="hl std">level,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl com">#View(hrtrain1)</span>

<span class="hl kwa">for</span><span class="hl std">(level</span> <span class="hl kwa">in</span> <span class="hl kwd">unique</span><span class="hl std">(hrtest1</span><span class="hl opt">$</span><span class="hl std">sales)){</span>
  <span class="hl std">hrtest1[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;dummy&quot;</span><span class="hl std">, level,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;_&quot;</span><span class="hl std">)]</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtest1</span><span class="hl opt">$</span><span class="hl std">sales</span> <span class="hl opt">==</span> <span class="hl std">level,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl kwa">for</span><span class="hl std">(level</span> <span class="hl kwa">in</span> <span class="hl kwd">unique</span><span class="hl std">(hrtest1</span><span class="hl opt">$</span><span class="hl std">salary)){</span>
  <span class="hl std">hrtest1[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;dummy&quot;</span><span class="hl std">, level,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;_&quot;</span><span class="hl std">)]</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtest1</span><span class="hl opt">$</span><span class="hl std">salary</span> <span class="hl opt">==</span> <span class="hl std">level,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl com">#View(hrtest1)</span>

<span class="hl std">hrtrain1_dummy</span> <span class="hl kwb">&lt;-</span> <span class="hl std">hrtrain1[,</span><span class="hl opt">-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">9</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">)]</span>
<span class="hl std">hrtest1_dummy</span> <span class="hl kwb">&lt;-</span> <span class="hl std">hrtest1[,</span><span class="hl opt">-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">9</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">)]</span>

<span class="hl com">#create sigmoid function</span>
<span class="hl std">sigmoid</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">z</span><span class="hl std">){</span>
  <span class="hl num">1</span><span class="hl opt">/</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">+</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">z))</span>
<span class="hl std">}</span>

<span class="hl com">#check whether our sigmoid is correct or not</span>
<span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span><span class="hl com">#correct for 0</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.5
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl num">10000</span><span class="hl std">)</span><span class="hl com">#correct for large positive value</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 1
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl num">10000</span><span class="hl std">)</span><span class="hl com">#correct for large negative value</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#cost function and gradient</span>
<span class="hl com"># h(x) = g(z)---sigmoid function</span>
<span class="hl com"># cost function j(beta) = (sum(i,-y(i)*log(h_beta(x(i)))-(1-y(i))*log(1-h_beta(x(i)))))*1/nrow(x(i)) --&gt; i for all rows/obs</span>
<span class="hl com"># gradient dj(beta)/d(beta(k)) = (sum(i,h_beta(x(i))-y(i)x(k)))*1/nrow(x(i)) --&gt; k is no of variables</span>

<span class="hl com">#now we will create X vectors</span>
<span class="hl com"># In X vector we will add 1 in each row for intercept</span>
<span class="hl com"># hrtest1$left&lt;- as.integer(hrtest1$left)</span>
<span class="hl com"># hrtrain1$left&lt;-as.numeric(hrtrain1$left)</span>
<span class="hl com"># table(hrtrain1$left)</span>
<span class="hl com"># table(hrtest1$left)</span>
<span class="hl std">y</span> <span class="hl kwb">&lt;-</span> <span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">left)</span>
<span class="hl std">ytest</span> <span class="hl kwb">&lt;-</span> <span class="hl std">(hrtest1</span><span class="hl opt">$</span><span class="hl std">left)</span>
<span class="hl kwd">class</span><span class="hl std">(hrtest1</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;numeric&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">X</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">cbind</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,hrtrain1[,</span><span class="hl opt">-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">7</span><span class="hl std">,</span><span class="hl num">9</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">)])</span>
<span class="hl kwd">head</span><span class="hl std">(X)</span>
</pre></div>
<div class="output"><pre class="knitr r">##       1 satisfaction_level last_evaluation number_project
## 10318 1               0.22            0.70              4
## 7382  1               0.71            0.56              3
## 5176  1               0.62            0.92              5
## 14922 1               0.10            0.86              6
## 10426 1               0.63            0.54              4
## 161   1               0.10            0.95              7
##       average_montly_hours time_spend_company Work_accident
## 10318                  225                  4             0
## 7382                   177                  4             0
## 5176                   149                  3             0
## 14922                  283                  4             0
## 10426                  147                  4             0
## 161                    301                  4             0
##       promotion_last_5years dummy_sales dummy_support dummy_IT
## 10318                     0           1             0        0
## 7382                      0           0             1        0
## 5176                      0           0             0        1
## 14922                     0           0             1        0
## 10426                     0           0             0        0
## 161                       0           0             0        0
##       dummy_technical dummy_marketing dummy_management dummy_RandD
## 10318               0               0                0           0
## 7382                0               0                0           0
## 5176                0               0                0           0
## 14922               0               0                0           0
## 10426               1               0                0           0
## 161                 0               1                0           0
##       dummy_product_mng dummy_accounting dummy_hr dummy_medium dummy_high
## 10318                 0                0        0            1          0
## 7382                  0                0        0            0          1
## 5176                  0                0        0            0          0
## 14922                 0                0        0            0          0
## 10426                 0                0        0            0          0
## 161                   0                0        0            0          0
##       dummy_low
## 10318         0
## 7382          0
## 5176          1
## 14922         1
## 10426         1
## 161           1
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">class</span><span class="hl std">(X)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;data.frame&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">Xtest</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">cbind</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,hrtest1[,</span><span class="hl opt">-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">7</span><span class="hl std">,</span><span class="hl num">9</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">)])</span>
<span class="hl kwd">head</span><span class="hl std">(Xtest)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    1 satisfaction_level last_evaluation number_project
## 1  1               0.38            0.53              2
## 4  1               0.72            0.87              5
## 5  1               0.37            0.52              2
## 6  1               0.41            0.50              2
## 10 1               0.42            0.53              2
## 13 1               0.84            0.92              4
##    average_montly_hours time_spend_company Work_accident
## 1                   157                  3             0
## 4                   223                  5             0
## 5                   159                  3             0
## 6                   153                  3             0
## 10                  142                  3             0
## 13                  234                  5             0
##    promotion_last_5years dummy_sales dummy_technical dummy_product_mng
## 1                      0           1               0                 0
## 4                      0           1               0                 0
## 5                      0           1               0                 0
## 6                      0           1               0                 0
## 10                     0           1               0                 0
## 13                     0           1               0                 0
##    dummy_IT dummy_marketing dummy_hr dummy_support dummy_management
## 1         0               0        0             0                0
## 4         0               0        0             0                0
## 5         0               0        0             0                0
## 6         0               0        0             0                0
## 10        0               0        0             0                0
## 13        0               0        0             0                0
##    dummy_accounting dummy_RandD dummy_low dummy_medium dummy_high
## 1                 0           0         1            0          0
## 4                 0           0         1            0          0
## 5                 0           0         1            0          0
## 6                 0           0         1            0          0
## 10                0           0         1            0          0
## 13                0           0         1            0          0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#Initialize fitting parameters</span>
<span class="hl std">initial_beta</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl kwd">ncol</span><span class="hl std">(X)))</span>
<span class="hl std">initial_beta</span>
</pre></div>
<div class="output"><pre class="knitr r">##       [,1]
##  [1,]    0
##  [2,]    0
##  [3,]    0
##  [4,]    0
##  [5,]    0
##  [6,]    0
##  [7,]    0
##  [8,]    0
##  [9,]    0
## [10,]    0
## [11,]    0
## [12,]    0
## [13,]    0
## [14,]    0
## [15,]    0
## [16,]    0
## [17,]    0
## [18,]    0
## [19,]    0
## [20,]    0
## [21,]    0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#create cost function</span>
<span class="hl std">costj</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">beta</span><span class="hl std">,</span> <span class="hl kwc">X</span><span class="hl std">,</span> <span class="hl kwc">y</span><span class="hl std">){</span>
  <span class="hl std">cgradient</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">()</span>
  <span class="hl std">h_beta</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)</span><span class="hl opt">%*%</span><span class="hl std">beta)</span>
  <span class="hl std">cost</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(X)</span><span class="hl opt">*</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">y</span><span class="hl opt">*</span><span class="hl kwd">log</span><span class="hl std">(h_beta)</span><span class="hl opt">-</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl std">y)</span><span class="hl opt">*</span><span class="hl kwd">log</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl std">h_beta))</span>
  <span class="hl kwd">return</span><span class="hl std">(cost)</span>
<span class="hl std">}</span>

<span class="hl com">#check cost of initial parameters</span>
<span class="hl kwd">costj</span><span class="hl std">(initial_beta,X,y)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.6931472
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#create gradient function</span>

<span class="hl std">gradientd</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">beta</span><span class="hl std">,</span> <span class="hl kwc">X</span><span class="hl std">,</span> <span class="hl kwc">y</span><span class="hl std">){</span>
  <span class="hl std">h_beta</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)</span><span class="hl opt">%*%</span><span class="hl std">beta)</span>
  <span class="hl std">gradient</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(X)</span><span class="hl opt">*</span><span class="hl std">(</span><span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl kwd">t</span><span class="hl std">(beta)</span><span class="hl opt">%*%</span><span class="hl kwd">t</span><span class="hl std">(</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)))</span><span class="hl opt">-</span><span class="hl kwd">t</span><span class="hl std">(y))</span><span class="hl opt">%*%</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)</span>
  <span class="hl kwd">return</span><span class="hl std">(gradient)</span>
<span class="hl std">}</span>

<span class="hl com">#check gradient for intial parameters</span>
<span class="hl kwd">gradientd</span><span class="hl std">(initial_beta,X,y)</span>
</pre></div>
<div class="output"><pre class="knitr r">##               1 satisfaction_level last_evaluation number_project
## [1,] -0.2659347         -0.2050453       -0.189924     -0.9992444
##      average_montly_hours time_spend_company Work_accident
## [1,]            -52.02925          -0.846253   -0.06151658
##      promotion_last_5years dummy_sales dummy_support    dummy_IT
## [1,]          -0.008489644 -0.07125078   -0.03862566 -0.02297982
##      dummy_technical dummy_marketing dummy_management dummy_RandD
## [1,]     -0.04533736     -0.01586808      -0.01457907 -0.01813495
##      dummy_product_mng dummy_accounting    dummy_hr dummy_medium
## [1,]       -0.01649035       -0.0124011 -0.01026758    -0.128367
##       dummy_high  dummy_low
## [1,] -0.03560316 -0.1019646
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#now we will optimize the cost to the get the optimum parameters</span>

<span class="hl std">opt_para</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">optim</span><span class="hl std">(</span><span class="hl kwc">par</span> <span class="hl std">= initial_beta,</span><span class="hl kwc">X</span><span class="hl std">=X,</span><span class="hl kwc">y</span><span class="hl std">=y,</span><span class="hl kwc">fn</span><span class="hl std">=costj,</span><span class="hl kwc">gr</span><span class="hl std">=gradientd)</span>
<span class="hl kwd">names</span><span class="hl std">(opt_para)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;par&quot;         &quot;value&quot;       &quot;counts&quot;      &quot;convergence&quot; &quot;message&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;optimized parameters are: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## optimized parameters are:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">round</span><span class="hl std">(opt_para</span><span class="hl opt">$</span><span class="hl std">par,</span><span class="hl num">3</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">##         [,1]
##  [1,]  0.429
##  [2,]  2.617
##  [3,] -1.279
##  [4,]  0.405
##  [5,] -0.002
##  [6,] -0.228
##  [7,]  0.413
##  [8,] -0.529
##  [9,]  0.073
## [10,]  0.148
## [11,] -0.165
## [12,]  0.093
## [13,]  0.174
## [14,]  0.108
## [15,]  0.248
## [16,] -0.923
## [17,] -0.566
## [18,] -0.478
## [19,] -0.083
## [20,]  0.342
## [21,] -0.501
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;cost at optimized parameters is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## cost at optimized parameters is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">round</span><span class="hl std">(opt_para</span><span class="hl opt">$</span><span class="hl std">value,</span><span class="hl num">3</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.462
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_prob</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)</span><span class="hl opt">%*%</span><span class="hl std">opt_para</span><span class="hl opt">$</span><span class="hl std">par)</span>
<span class="hl std">hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_prob</span><span class="hl opt">&gt;=</span><span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">)</span>

<span class="hl std">accuracy</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl std">hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label)</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtrain1)</span>
<span class="hl std">accuracy</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.7446884
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">tp</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">))</span>
<span class="hl std">tp</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 8086
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">fp</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">0</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">))</span>
<span class="hl std">fp</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 2342
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">prec</span> <span class="hl kwb">=</span> <span class="hl std">tp</span><span class="hl opt">/</span><span class="hl std">(tp</span><span class="hl opt">+</span><span class="hl std">fp)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The precision is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The precision is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">prec</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.7754124
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#tp = sum((hrtrain1$left==1)&amp;(hrtrain1$fitted_label==1))</span>
<span class="hl std">fn</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">0</span><span class="hl std">))</span>
<span class="hl std">rec</span> <span class="hl kwb">=</span> <span class="hl std">tp</span><span class="hl opt">/</span><span class="hl std">(tp</span><span class="hl opt">+</span><span class="hl std">fn)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The recall is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The recall is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">rec</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9384865
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">F1</span> <span class="hl kwb">=</span> <span class="hl num">2</span><span class="hl opt">*</span><span class="hl std">(prec</span><span class="hl opt">*</span><span class="hl std">rec)</span><span class="hl opt">/</span><span class="hl std">(prec</span><span class="hl opt">+</span><span class="hl std">rec)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The F1 score is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The F1 score is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">F1</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.8491913
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">###############################################################################</span>
<span class="hl com">############Regularized Logistic Regression with optimization##################</span>
<span class="hl com">###############################################################################</span>

<span class="hl com">#Initialize fitting parameters</span>
<span class="hl std">initial_beta</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl kwd">ncol</span><span class="hl std">(X)))</span>
<span class="hl std">initial_beta</span>
</pre></div>
<div class="output"><pre class="knitr r">##       [,1]
##  [1,]    0
##  [2,]    0
##  [3,]    0
##  [4,]    0
##  [5,]    0
##  [6,]    0
##  [7,]    0
##  [8,]    0
##  [9,]    0
## [10,]    0
## [11,]    0
## [12,]    0
## [13,]    0
## [14,]    0
## [15,]    0
## [16,]    0
## [17,]    0
## [18,]    0
## [19,]    0
## [20,]    0
## [21,]    0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#create cost function for regularization</span>
<span class="hl std">costr</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">beta</span><span class="hl std">,</span> <span class="hl kwc">X</span><span class="hl std">,</span> <span class="hl kwc">y</span><span class="hl std">,</span><span class="hl kwc">lambda</span><span class="hl std">){</span>
  <span class="hl std">cgradient</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">()</span>
  <span class="hl std">h_beta</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)</span><span class="hl opt">%*%</span><span class="hl std">beta)</span>
  <span class="hl std">cost</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(X)</span><span class="hl opt">*</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">y</span><span class="hl opt">*</span><span class="hl kwd">log</span><span class="hl std">(h_beta)</span><span class="hl opt">-</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl std">y)</span><span class="hl opt">*</span><span class="hl kwd">log</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl std">h_beta))</span><span class="hl opt">+</span><span class="hl std">lambda</span><span class="hl opt">/</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl opt">*</span><span class="hl kwd">nrow</span><span class="hl std">(X))</span><span class="hl opt">*</span><span class="hl kwd">sum</span><span class="hl std">(beta</span><span class="hl opt">^</span><span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">return</span><span class="hl std">(cost)</span>
<span class="hl std">}</span>

<span class="hl com">#check cost of initial parameters</span>
<span class="hl kwd">costr</span><span class="hl std">(initial_beta,X,y,</span><span class="hl kwc">lambda</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.6931472
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#create gradient function</span>

<span class="hl std">gradientr</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">beta</span><span class="hl std">,</span> <span class="hl kwc">X</span><span class="hl std">,</span> <span class="hl kwc">y</span><span class="hl std">,</span><span class="hl kwc">lambda</span><span class="hl std">){</span>
  <span class="hl std">h_beta</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)</span><span class="hl opt">%*%</span><span class="hl std">beta)</span>
  <span class="hl std">gradient</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(X)</span><span class="hl opt">*</span><span class="hl std">(</span><span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl kwd">t</span><span class="hl std">(beta)</span><span class="hl opt">%*%</span><span class="hl kwd">t</span><span class="hl std">(</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)))</span><span class="hl opt">-</span><span class="hl kwd">t</span><span class="hl std">(y))</span><span class="hl opt">%*%</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)</span><span class="hl opt">+</span><span class="hl std">(lambda</span><span class="hl opt">/</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(X)))</span><span class="hl opt">*</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,beta[</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">])</span>
  <span class="hl kwd">return</span><span class="hl std">(gradient)</span>
<span class="hl std">}</span>

<span class="hl com">#check gradient for intial parameters</span>
<span class="hl kwd">gradientr</span><span class="hl std">(initial_beta,X,y,</span><span class="hl kwc">lambda</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">##               1 satisfaction_level last_evaluation number_project
## [1,] -0.2659347         -0.2050453       -0.189924     -0.9992444
##      average_montly_hours time_spend_company Work_accident
## [1,]            -52.02925          -0.846253   -0.06151658
##      promotion_last_5years dummy_sales dummy_support    dummy_IT
## [1,]          -0.008489644 -0.07125078   -0.03862566 -0.02297982
##      dummy_technical dummy_marketing dummy_management dummy_RandD
## [1,]     -0.04533736     -0.01586808      -0.01457907 -0.01813495
##      dummy_product_mng dummy_accounting    dummy_hr dummy_medium
## [1,]       -0.01649035       -0.0124011 -0.01026758    -0.128367
##       dummy_high  dummy_low
## [1,] -0.03560316 -0.1019646
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#now we will optimize the cost to the get the optimum parameters</span>

<span class="hl std">opt_rpara</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">optim</span><span class="hl std">(</span><span class="hl kwc">par</span> <span class="hl std">= initial_beta,</span><span class="hl kwc">X</span><span class="hl std">=X,</span><span class="hl kwc">y</span><span class="hl std">=y,</span><span class="hl kwc">lambda</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl kwc">fn</span><span class="hl std">=costr,</span><span class="hl kwc">gr</span><span class="hl std">=gradientr,</span><span class="hl kwc">method</span> <span class="hl std">=</span> <span class="hl str">&quot;BFGS&quot;</span><span class="hl std">)</span>
<span class="hl kwd">names</span><span class="hl std">(opt_rpara)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;par&quot;         &quot;value&quot;       &quot;counts&quot;      &quot;convergence&quot; &quot;message&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;optimized parameters are: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## optimized parameters are:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">round</span><span class="hl std">(opt_rpara</span><span class="hl opt">$</span><span class="hl std">par,</span><span class="hl num">3</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">##         [,1]
##  [1,]  0.248
##  [2,]  4.187
##  [3,] -0.770
##  [4,]  0.302
##  [5,] -0.004
##  [6,] -0.248
##  [7,]  1.444
##  [8,]  1.082
##  [9,] -0.027
## [10,] -0.091
## [11,]  0.059
## [12,] -0.140
## [13,]  0.028
## [14,]  0.254
## [15,]  0.456
## [16,]  0.028
## [17,] -0.009
## [18,] -0.346
## [19,] -0.221
## [20,]  1.169
## [21,] -0.735
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;cost at optimized parameters is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## cost at optimized parameters is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">round</span><span class="hl std">(opt_rpara</span><span class="hl opt">$</span><span class="hl std">value,</span><span class="hl num">3</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.426
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># predict &lt;- sigmoid(as.matrix(Xtest)%*%opt_para$par)</span>
<span class="hl com"># predicttest &lt;- ifelse(predict&gt;=0.5,1,0)</span>
<span class="hl com"># View(predict)</span>
<span class="hl com"># joinpredictactual &lt;- cbind(ytest,predicttest)</span>
<span class="hl com"># View(joinpredictactual)</span>

<span class="hl std">hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_prob</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sigmoid</span><span class="hl std">(</span><span class="hl kwd">as.matrix</span><span class="hl std">(X)</span><span class="hl opt">%*%</span><span class="hl std">opt_rpara</span><span class="hl opt">$</span><span class="hl std">par)</span>
<span class="hl std">hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_prob</span><span class="hl opt">&gt;=</span><span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl kwd">head</span><span class="hl std">(hrtrain1)</span>
</pre></div>
<div class="output"><pre class="knitr r">##       satisfaction_level last_evaluation number_project
## 10318               0.22            0.70              4
## 7382                0.71            0.56              3
## 5176                0.62            0.92              5
## 14922               0.10            0.86              6
## 10426               0.63            0.54              4
## 161                 0.10            0.95              7
##       average_montly_hours time_spend_company Work_accident left
## 10318                  225                  4             0    1
## 7382                   177                  4             0    1
## 5176                   149                  3             0    1
## 14922                  283                  4             0    0
## 10426                  147                  4             0    1
## 161                    301                  4             0    0
##       promotion_last_5years     sales salary dummy_sales dummy_support
## 10318                     0     sales medium           1             0
## 7382                      0   support   high           0             1
## 5176                      0        IT    low           0             0
## 14922                     0   support    low           0             1
## 10426                     0 technical    low           0             0
## 161                       0 marketing    low           0             0
##       dummy_IT dummy_technical dummy_marketing dummy_management
## 10318        0               0               0                0
## 7382         0               0               0                0
## 5176         1               0               0                0
## 14922        0               0               0                0
## 10426        0               1               0                0
## 161          0               0               1                0
##       dummy_RandD dummy_product_mng dummy_accounting dummy_hr dummy_medium
## 10318           0                 0                0        0            1
## 7382            0                 0                0        0            0
## 5176            0                 0                0        0            0
## 14922           0                 0                0        0            0
## 10426           0                 0                0        0            0
## 161             0                 0                0        0            0
##       dummy_high dummy_low fitted_prob fitted_label
## 10318          0         0   0.4291378            0
## 7382           1         0   0.9563341            1
## 5176           0         1   0.8375623            1
## 14922          0         1   0.2474131            0
## 10426          0         1   0.7743076            1
## 161            0         1   0.3034366            0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(hrtrain</span><span class="hl opt">$</span><span class="hl std">left)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##    0    1 
## 8616 2633
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">table</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">left,hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    
##        0    1
##   0  881 1752
##   1  587 8029
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">accuracy</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl std">hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label)</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrtrain1)</span>
<span class="hl std">accuracy</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.7920704
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># though the accuracy has been improved but it does not seem good fit classification.</span>

<span class="hl std">tp</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">))</span>
<span class="hl std">tp</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 8029
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">fp</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">0</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">))</span>
<span class="hl std">fp</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 1752
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">prec</span> <span class="hl kwb">=</span> <span class="hl std">tp</span><span class="hl opt">/</span><span class="hl std">(tp</span><span class="hl opt">+</span><span class="hl std">fp)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The precision is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The precision is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">prec</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.8208772
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#tp = sum((hrtrain1$left==1)&amp;(hrtrain1$fitted_label==1))</span>
<span class="hl std">fn</span> <span class="hl kwb">=</span> <span class="hl kwd">sum</span><span class="hl std">((hrtrain1</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl opt">==</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">&amp;</span><span class="hl std">(hrtrain1</span><span class="hl opt">$</span><span class="hl std">fitted_label</span><span class="hl opt">==</span><span class="hl num">0</span><span class="hl std">))</span>
<span class="hl std">rec</span> <span class="hl kwb">=</span> <span class="hl std">tp</span><span class="hl opt">/</span><span class="hl std">(tp</span><span class="hl opt">+</span><span class="hl std">fn)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The recall is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The recall is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">rec</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9318709
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">F1</span> <span class="hl kwb">=</span> <span class="hl num">2</span><span class="hl opt">*</span><span class="hl std">(prec</span><span class="hl opt">*</span><span class="hl std">rec)</span><span class="hl opt">/</span><span class="hl std">(prec</span><span class="hl opt">+</span><span class="hl std">rec)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;The F1 score is: &quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## The F1 score is:
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">F1</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.8728597
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#F1 score (also F-score or F-measure) is a measure of a test's accuracy. </span>
<span class="hl com"># It considers both the precision p and the recall r of the test to compute </span>
<span class="hl com"># the score: p is the number of correct positive results divided by the number </span>
<span class="hl com"># of all positive results returned by the classifier, and r is the number of </span>
<span class="hl com"># correct positive results divided by the number of all relevant samples </span>
<span class="hl com"># (all samples that should have been identified as positive). The F1 score </span>
<span class="hl com"># is the harmonic average of the precision and recall, where an F1 score </span>
<span class="hl com"># reaches its best value at 1 (perfect precision and recall) and worst at 0.</span>

<span class="hl com"># So regularization in this case does not give the best model.</span>
<span class="hl com">#########################################################################</span>
<span class="hl com">###########################Best Model Description########################</span>
<span class="hl com"># #so the best algo which provides the correctd prediction is from random forest which is</span>
<span class="hl com">#rfmodel2 with few predictors. </span>
<span class="hl com">#So we will create final model using Random forest with few predictors</span>
<span class="hl com"># as suggested by the fit and validation.</span>

<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">1000</span><span class="hl std">)</span>
<span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">left</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.factor</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">left)</span>
<span class="hl kwd">class</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">sales)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;character&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">sales</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.factor</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">sales)</span>
<span class="hl std">hrdata</span><span class="hl opt">$</span><span class="hl std">salary</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.factor</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">salary)</span>
<span class="hl std">Best_Model</span><span class="hl kwb">=</span><span class="hl kwd">randomForest</span><span class="hl std">(</span><span class="hl kwc">formula</span><span class="hl std">=left</span><span class="hl opt">~</span><span class="hl std">satisfaction_level</span><span class="hl opt">+</span><span class="hl std">number_project</span>
                     <span class="hl opt">+</span><span class="hl std">time_spend_company</span><span class="hl opt">+</span><span class="hl std">average_montly_hours</span><span class="hl opt">+</span><span class="hl std">last_evaluation</span>
                     <span class="hl std">,</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">importance</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">,</span><span class="hl kwc">mtry</span><span class="hl std">=</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl kwc">do.trace</span><span class="hl std">=</span><span class="hl num">100</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## ntree      OOB      1      2
##   100:   0.83%  0.32%  2.46%
##   200:   0.77%  0.27%  2.38%
##   300:   0.78%  0.28%  2.38%
##   400:   0.78%  0.28%  2.38%
##   500:   0.79%  0.29%  2.38%
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">varImpPlot</span><span class="hl std">(Best_Model)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-65.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">print</span><span class="hl std">(Best_Model)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## Call:
##  randomForest(formula = left ~ satisfaction_level + number_project +      time_spend_company + average_montly_hours + last_evaluation,      data = hrdata, importance = TRUE, mtry = 3, do.trace = 100) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 3
## 
##         OOB estimate of  error rate: 0.79%
## Confusion matrix:
##       0    1 class.error
## 0 11395   33 0.002887644
## 1    85 3486 0.023802856
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">Best_Model</span><span class="hl opt">$</span><span class="hl std">confusion</span>
</pre></div>
<div class="output"><pre class="knitr r">##       0    1 class.error
## 0 11395   33 0.002887644
## 1    85 3486 0.023802856
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Best_Model$predicted</span>
<span class="hl std">Best_fitted</span> <span class="hl kwb">&lt;-</span> <span class="hl std">Best_Model</span><span class="hl opt">$</span><span class="hl std">predicted</span>

<span class="hl com">#Best_fitted=predict(object=Best_Model,newdata=hrdata,type=&quot;response&quot;)</span>

<span class="hl kwd">table</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">left,Best_fitted)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    Best_fitted
##         0     1
##   0 11395    33
##   1    85  3486
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">table</span><span class="hl std">(hrdata</span><span class="hl opt">$</span><span class="hl std">left,Best_fitted)))</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(hrdata)</span> <span class="hl com">#99.25%</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9921328
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#2. ROC</span>

<span class="hl kwd">plotROC</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrdata</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(Best_fitted))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-66.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">#since the area under curve is 98.55, we can say  the discrimination  ability</span>
<span class="hl com"># of our model is good.</span>

<span class="hl com">#3. Kolmogrov Smirnov Chart</span>
<span class="hl com">#measure the performance of classification models.</span>

<span class="hl kwd">ks_plot</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrdata</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(Best_fitted))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-67.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># as the measure between left and not-left is large, we can say that</span>
<span class="hl com"># performance of the Best model is good.</span>
<span class="hl kwd">ks_stat</span><span class="hl std">(</span><span class="hl kwc">actuals</span> <span class="hl std">= hrdata</span><span class="hl opt">$</span><span class="hl std">left,</span><span class="hl kwc">predictedScores</span> <span class="hl std">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(Best_fitted))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.9187
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#As the kolmogrov Smirnov statistic is 0.91.8 which is good, we can say </span>
<span class="hl com"># that the Best model is efficient in capturing  the responders(1).</span>

<span class="hl std">Best_Model</span><span class="hl opt">$</span><span class="hl std">importance</span>
</pre></div>
<div class="output"><pre class="knitr r">##                                0         1 MeanDecreaseAccuracy
## satisfaction_level   0.067029231 0.6432054            0.2040259
## number_project       0.021960111 0.4855721            0.1321926
## time_spend_company   0.012237787 0.3166658            0.0845776
## average_montly_hours 0.021578796 0.4310924            0.1189480
## last_evaluation      0.004883856 0.4685621            0.1151471
##                      MeanDecreaseGini
## satisfaction_level          2270.8914
## number_project               839.2562
## time_spend_company           957.8192
## average_montly_hours         719.0021
## last_evaluation              649.8613
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#As we have also best model from pre-prune decision tree and also random</span>
<span class="hl com"># forest creates multiple decision tree so we have considered the plot</span>
<span class="hl com"># of one of decision tree for explaning the business.</span>
<span class="hl std">dctree4plot</span><span class="hl kwb">=</span><span class="hl kwd">rpart</span><span class="hl std">(</span><span class="hl kwc">formula</span><span class="hl std">=left</span><span class="hl opt">~</span><span class="hl std">satisfaction_level</span><span class="hl opt">+</span><span class="hl std">number_project</span>
                    <span class="hl opt">+</span><span class="hl std">time_spend_company</span><span class="hl opt">+</span><span class="hl std">average_montly_hours</span><span class="hl opt">+</span><span class="hl std">last_evaluation</span>
                    <span class="hl std">,</span><span class="hl kwc">data</span><span class="hl std">=hrdata,</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;class&quot;</span><span class="hl std">,</span>
                    <span class="hl kwc">control</span> <span class="hl std">=</span> <span class="hl kwd">rpart.control</span><span class="hl std">(</span><span class="hl kwc">cp</span> <span class="hl std">=</span> <span class="hl num">0.0</span><span class="hl std">,</span><span class="hl kwc">maxdepth</span> <span class="hl std">=</span> <span class="hl num">9</span><span class="hl std">,</span><span class="hl kwc">minsplit</span> <span class="hl std">=</span> <span class="hl num">100</span><span class="hl std">,</span><span class="hl kwc">minbucket</span> <span class="hl std">=</span> <span class="hl num">20</span><span class="hl std">))</span>
<span class="hl com">#summary(rpartmodelpre)</span>
<span class="hl kwd">windows</span><span class="hl std">()</span>
<span class="hl kwd">fancyRpartPlot</span><span class="hl std">(</span><span class="hl kwc">model</span><span class="hl std">=dctree4plot,</span><span class="hl kwc">main</span><span class="hl std">=</span><span class="hl str">&quot;Tree of  Hr model&quot;</span><span class="hl std">,</span><span class="hl kwc">cex</span><span class="hl std">=</span><span class="hl num">0.6</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-1-68.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># So the conclusion is:</span>
<span class="hl com">#1. The critical attributes on which the business has to focus on are:</span>
<span class="hl com">#a.satisfaction_level</span>
<span class="hl com">#b.number_project</span>
<span class="hl com">#c.time_spend_company</span>
<span class="hl com">#d.average_montly_hours</span>
<span class="hl com">#e.last_evaluation</span>
<span class="hl com">#2.As the satisfaction level increases mostly people tend to leave the</span>
<span class="hl com"># Organization.</span>
<span class="hl com">#3. More people tend to leave if they have less than 3 projects, so </span>
<span class="hl com"># business has to focus on employee and the project they should be alligned to.</span>
<span class="hl com">#4.People who spends daily on an average 6.5 hours in the office, they </span>
<span class="hl com"># do not tend to leave the organization, so policy need to brought in to</span>
<span class="hl com"># strictly follow the business hours.</span>
<span class="hl com">#5.Employees who spend less than 126 hours on monthly basis they are the</span>
<span class="hl com"># ones who are leaving the organization in bigger number.</span>
<span class="hl com">#6.Employess who has last_evaluation less than .44 they are not leaving </span>
<span class="hl com"># the organization, it mean employees need to evaluated frequently so</span>
<span class="hl com"># they can understand their goals and do not leave the organization.</span>
<span class="hl com">#7. Other attributes are not much impacting the attrition rate.</span>
<span class="hl com">#8.This does not sums up the conclusion of HR Analytics Model, as the time</span>
<span class="hl com"># progress we have to evolve this model and improve the model and remove</span>
<span class="hl com">#the nuances.</span>
</pre></div>
</div></div>

<p>You can also embed plots, for example:</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#plot(cars)</span>
</pre></div>
</div></div>

</body>
</html>
